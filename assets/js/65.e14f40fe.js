(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{399:function(t,a,s){"use strict";s.r(a);var e=s(28),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_1-포드-레플리카-셋-디플로이먼트-서비스"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-포드-레플리카-셋-디플로이먼트-서비스"}},[t._v("#")]),t._v(" 1.포드, 레플리카 셋, 디플로이먼트, 서비스")]),t._v(" "),a("h2",{attrs:{id:"개요"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#개요"}},[t._v("#")]),t._v(" 개요")]),t._v(" "),a("ul",[a("li",[t._v("컨테이너 오케스트레이션 도구")]),t._v(" "),a("li",[t._v("서버 자원 클러스터링, MSA 구조의 컨테이너 배포, 페일오버 처리 등")]),t._v(" "),a("li",[t._v("컨테이너 기반의 클라우드를 운영할 때 필요한 기능과 컴포넌트 커스터마이징 가능\n"),a("ul",[a("li",[t._v("(e.g. PV, 장애 복구, 스케줄링, 오토 스케일링 등)")])])]),t._v(" "),a("li",[t._v("여러 개의 노드로 구성됨(마스터, 워커)")])]),t._v(" "),a("h2",{attrs:{id:"쿠버네티스-노드의-역할"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#쿠버네티스-노드의-역할"}},[t._v("#")]),t._v(" 쿠버네티스 노드의 역할")]),t._v(" "),a("ul",[a("li",[t._v("마스터 : 쿠버네티스가 제대로 동작할 수 있게 클러스터 관리하는 역할")]),t._v(" "),a("li",[t._v("워커 : 애플리케이션 컨테이너 생성")])]),t._v(" "),a("h1",{attrs:{id:"pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[t._v("#")]),t._v(" Pod")]),t._v(" "),a("ul",[a("li",[t._v("컨테이너 애플리케이션의 기본 단위")]),t._v(" "),a("li",[t._v("1개 이상의 컨테이너로 구성된 컨테이너의 집합")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx-pod.yaml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("container\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n")])])]),a("ul",[a("li",[a("code",[t._v("kubectl apply -f")]),t._v(" 명령어로 쿠버네티스에 생성 가능")]),t._v(" "),a("li",[a("code",[t._v("kubectl describe")]),t._v(" 명령어로 리소스 정보를 볼 수 있음")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl describe pods my-nginx-pod\nName:             my-nginx-pod\nNamespace:        default\nPriority:         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nService Account:  default\nNode:             rpi4b/192.168.0.7\nStart Time:       Fri, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2025")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(":38:38 +0900\nLabels:           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAnnotations:      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nStatus:           Running\nIP:               "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.42")]),t._v(".0.129 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 클러스터 내부에서 접속가능한 IP")]),t._v("\nIPs:\n  IP:  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.42")]),t._v(".0.129\nContainers:\n  my-nginx-container:\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("ul",[a("li",[a("code",[t._v("kubectl logs")]),t._v("로 로그 확인 가능")]),t._v(" "),a("li",[a("code",[t._v("kubectl delete -f")]),t._v(" 명령어로 쿠버네티스 오브젝트 삭제 가능")])]),t._v(" "),a("h2",{attrs:{id:"pod-vs-docker-container"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pod-vs-docker-container"}},[t._v("#")]),t._v(" Pod vs Docker Container")]),t._v(" "),a("ul",[a("li",[t._v("쿠버네티스가 'Pod'라는 새로운 개념을 도입한 이유는 "),a("strong",[t._v("리눅스 네임스페이스")]),t._v("를 공유하는 여러 컨테이너를 추상화된 집합으로 사용하기 위함")]),t._v(" "),a("li",[t._v("하나의 포드는 하나의 완전한 애플리케이션으로써 만들어져야 함\n"),a("ul",[a("li",[t._v("nginx 컨테이너 1개 (o)")]),t._v(" "),a("li",[t._v("nginx 컨테이너 2개 (x : nginx 컨테이너는 그 자체만으로 완전한 애플리케이션이기 때문)")]),t._v(" "),a("li",[t._v("nginx 컨테이너 + 로그 수집 컨테이너 (o : 주 컨테이너에 대해 기능 확장을 위한 "),a("strong",[t._v("사이드카 컨테이너")]),t._v("가 포함되어야 할 수 있음)")])])])]),t._v(" "),a("h2",{attrs:{id:"사이드카-컨테이너"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#사이드카-컨테이너"}},[t._v("#")]),t._v(" 사이드카 컨테이너")]),t._v(" "),a("ul",[a("li",[t._v("포드에 정의된 부가적인 컨테이너")]),t._v(" "),a("li",[t._v("주 컨테이너에 대해 기능 확장을 위한 컨테이너")]),t._v(" "),a("li",[t._v("한 포드 내의 다른 컨테이너와 네트워크 환경 등을 공유")])]),t._v(" "),a("h1",{attrs:{id:"replica-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#replica-set"}},[t._v("#")]),t._v(" Replica Set")]),t._v(" "),a("ul",[a("li",[t._v("일정 개수의 포드를 유지하는 컨트롤러")])]),t._v(" "),a("h2",{attrs:{id:"레플리카-셋을-사용하는-이유"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#레플리카-셋을-사용하는-이유"}},[t._v("#")]),t._v(" 레플리카 셋을 사용하는 이유?")]),t._v(" "),a("ul",[a("li",[t._v("정해진 수의 동일한 포드가 항상 실행되도록 관리\n"),a("ul",[a("li",[t._v("포드만 사용한다면 원하는 컨테이너 개수만큼 직접 생성해줘야 함")])])]),t._v(" "),a("li",[t._v("노드 장애 등의 이유로 포드를 사용할 수 없다면 다른 노드에서 포드 다시 실행 * 포드만 사용한다면 사용 불가능한 상태로 남아있음\n→ 결국 동일한 포드를 안정적으로 여러 개 실행하고 장애가 생기더라도 정해진 포드 개수를 유지하기 위함")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ---레플리카 셋 정의---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ReplicaSet\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" replicaset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pods"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("label\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ---포드 정의---")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pods"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("label\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),a("ul",[a("li",[a("strong",[t._v("spec.selector.matchLabels")]),t._v("를 통해 생성해야 하는 포드를 찾음")]),t._v(" "),a("li",[t._v("즉 "),a("code",[t._v("app: my-nginx-pods-label")]),t._v(" 라벨을 가지는 포드의 개수가 replicas 항목에 정의된 숫자와 일치하지 않으면 포드 템플릿으로 포드 생성")])]),t._v(" "),a("h1",{attrs:{id:"deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[t._v("#")]),t._v(" Deployment")]),t._v(" "),a("ul",[a("li",[t._v("레플리카셋, 포드의 배포를 관리")]),t._v(" "),a("li",[t._v("실제 쿠버네티스 운영환경에서는 레플리카셋과 포드의 정보를 정의하는 "),a("code",[t._v("Deployment")]),t._v("라는 오브젝트를 정의해 사용")]),t._v(" "),a("li",[t._v("디플로이먼트는 레플리카셋의 상위 오브젝트\n→ 디플로이언트를 생성하면 해당 디플로이먼트에 대응하는 레플리카셋도 함께 생성됨")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),a("ul",[a("li",[t._v("디플로이먼트, 레플리카 셋, 포드가 함께 생성되는 모습")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get deployment\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nmy-nginx-deployment   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("/3     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("           21s\n\n$ kubectl get replicaset\nNAME                            DESIRED   CURRENT   READY   AGE\nmy-nginx-deployment-9b459b4c5   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("       26s\n\n$ kubectl get pods\nNAME                                  READY   STATUS    RESTARTS   AGE\nmy-nginx-deployment-9b459b4c5-cst47   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          98s\nmy-nginx-deployment-9b459b4c5-gzwtc   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          98s\nmy-nginx-deployment-9b459b4c5-lpklh   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          98s\n")])])]),a("h2",{attrs:{id:"디플로이먼트를-사용하는-이유"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#디플로이먼트를-사용하는-이유"}},[t._v("#")]),t._v(" 디플로이먼트를 사용하는 이유?")]),t._v(" "),a("ul",[a("li",[t._v("애플리케이션의 업데이트와 배포를 더욱 편하기 만들기 위함\n"),a("ul",[a("li",[t._v("애플리케이션 업데이트 시 레플리카 셋의 변경 사항을 관리하는 revision을 남겨 롤백을 가능하게 해줌")]),t._v(" "),a("li",[t._v("무중단 서비스를 위해 포드의 롤링 업데이트 전략을 지정할 수 있음")])])]),t._v(" "),a("li",[t._v("ex : "),a("code",[t._v("--record")]),t._v(" 옵션 사용")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" deployment-nginx.yaml "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--record")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# --record 옵션으로 이전 정보를 리비전으로써 보존")]),t._v("\nFlag "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--record")]),t._v(" has been deprecated, "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--record")]),t._v(" will be removed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the future\ndeployment.apps/my-nginx-deployment created\n\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" image deployment my-nginx-deployment "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("nginx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx:1.11 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--record")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 이미지 변경")]),t._v("\nFlag "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--record")]),t._v(" has been deprecated, "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--record")]),t._v(" will be removed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the future\ndeployment.apps/my-nginx-deployment image updated\n\n$ kubectl get rs "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 오류 발생")]),t._v("\nNAME                             DESIRED   CURRENT   READY   AGE\nmy-nginx-deployment-759b76bcd5   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("       60s\nmy-nginx-deployment-9b459b4c5    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("       99s\n\n$ kubectl get pods "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 오류 발생")]),t._v("\nNAME                                   READY   STATUS             RESTARTS      AGE\nmy-nginx-deployment-759b76bcd5-4jccd   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     CrashLoopBackOff   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("29s ago"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   119s\nmy-nginx-deployment-759b76bcd5-vk9ck   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     CrashLoopBackOff   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("48s ago"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   97s\nmy-nginx-deployment-9b459b4c5-n29cz    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("             2m38s\nmy-nginx-deployment-9b459b4c5-v4sq8    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("             2m38s\n\n$ kubectl rollout "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("history")]),t._v(" deployment my-nginx-deployment "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 리비전 확인")]),t._v("\ndeployment.apps/my-nginx-deployment\nREVISION  CHANGE-CAUSE\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("         kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("deployment-nginx.yaml "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--record")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("         kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" image deployment my-nginx-deployment "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("nginx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx:1.11 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--record")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n\n$ kubectl rollout undo deployment my-nginx-deployment --to-revision"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 리비전 1로 롤백")]),t._v("\ndeployment.apps/my-nginx-deployment rolled back\n\n$ kubectl get rs "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 롤백 완료")]),t._v("\nNAME                             DESIRED   CURRENT   READY   AGE\nmy-nginx-deployment-759b76bcd5   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("       2m36s\nmy-nginx-deployment-9b459b4c5    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("       3m15s\n\n$ kubectl get pods "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 롤백 완료")]),t._v("\nNAME                                  READY   STATUS    RESTARTS   AGE\nmy-nginx-deployment-9b459b4c5-7xcbx   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          11s\nmy-nginx-deployment-9b459b4c5-n29cz   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3m21s\nmy-nginx-deployment-9b459b4c5-v4sq8   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3m21s\n")])])]),a("h1",{attrs:{id:"service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[t._v("#")]),t._v(" Service")]),t._v(" "),a("ul",[a("li",[t._v("포드를 연결하고 외부에 노출하는 역할")]),t._v(" "),a("li",[t._v("기존에 "),a("code",[t._v("kubectl describe")]),t._v(" 명령어로 확인한 포드 내부 IP는 클러스터 내부에서만 접근 가능 + 영속적이지 않음")]),t._v(" "),a("li",[t._v("서비스는 포드에 접근하기 위한 규칙을 정의\n"),a("ul",[a("li",[t._v("여러 개의 포드에 쉽게 접근할 수 있도록 고유한 도메인 네임 부여")]),t._v(" "),a("li",[t._v("여러 개의 포드에 접근할 때, 요청을 분산하는 로드 밸런서 기능")]),t._v(" "),a("li",[t._v("포드를 외부로 노출")])])])]),t._v(" "),a("h2",{attrs:{id:"서비스-종류"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#서비스-종류"}},[t._v("#")]),t._v(" 서비스 종류")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("ClusterIP 타입")]),t._v(" : 쿠버네티스 내부에서만 포드들에 접근할 때 사용. 외부로 포드를 노출하지 않고 쿠버네티스 클러스터 내부에서만 사용되는 포드에 적합")]),t._v(" "),a("li",[a("strong",[t._v("NodePort 타입")]),t._v(" : 포드에 접근할 수 있는 포트를 클러스터의 모든 노드에 동일하게 개방. 외부에서 포드에 접근 가능. 접근 포트는 랜덤으로 정해지지만 특정 포트로 접근하도록 설정도 가능")]),t._v(" "),a("li",[a("strong",[t._v("LordBalancer 타입")]),t._v(" : 클라우드 플랫폼(AWS, GCP 등)에서 제공하는 로드 밸런서를 동적으로 프로비저닝해 포드에 연결. NodePort 타입과 마찬가지로 외부에서 포드에 접근 가능. 일반적으로 클라우드 플랫폼 환경에서만 사용 가능")])]),t._v(" "),a("h2",{attrs:{id:"clusterip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clusterip"}},[t._v("#")]),t._v(" ClusterIP")]),t._v(" "),a("h3",{attrs:{id:"deployment-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployment-2"}},[t._v("#")]),t._v(" Deployment")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webserver\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("webserver\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webserver\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("webserver\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" alicek106/rr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("echo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("hostname\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),a("h3",{attrs:{id:"service-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-2"}},[t._v("#")]),t._v(" Service")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("clusterip\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webserver\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterIP\n")])])]),a("ul",[a("li",[a("code",[t._v("webserver")]),t._v("라는 라벨을 가진 포드들을 8080 → 80 으로 바인딩")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get svc\nNAME                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    AGE\nhostname-svc-clusterip   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.43")]),t._v(".49.255   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/TCP   2m54s\n\n$ kubectl run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--tty")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--rm")]),t._v(" debug "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("alicek106/ubuntu:curl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Nev\ner -- "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nroot@debug:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl 10.43.49.255:8080 --silent | grep Hello")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello, hostname-deployment-96df6b9c4-t5lpr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nroot@debug:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl hostname-svc-clusterip:8080 --silent | grep Hello")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello, hostname-deployment-96df6b9c4-w4pfb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("ul",[a("li",[t._v("위와 같이 클러스터 내의 임시 포드를 만들어 요청을 전송해볼 수 있음")]),t._v(" "),a("li",[t._v("IP 뿐만 아니라 서비스 이름 그 자체로도 접근 가능")]),t._v(" "),a("li",[t._v("여러 포드가 클러스터 내부에서 서로를 찾아 연결할 때는 서비스의 이름과 같은 도메인 이름을 사용하는 것이 일반적")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@debug:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl hostname-svc-clusterip:8080 --silent | grep Hello")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello, hostname-deployment-96df6b9c4-w4pfb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nroot@debug:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl hostname-svc-clusterip:8080 --silent | grep Hello")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello, hostname-deployment-96df6b9c4-t5lpr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nroot@debug:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl hostname-svc-clusterip:8080 --silent | grep Hello")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello, hostname-deployment-96df6b9c4-zf8q"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v("<")]),t._v("/p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("ul",[a("li",[t._v("서비스는 연결된 포드들에 대해 자동으로 로드 밸런싱 수행")])]),t._v(" "),a("h3",{attrs:{id:"endpoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#endpoint"}},[t._v("#")]),t._v(" endpoint")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get svc\nNAME                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    AGE\nhostname-svc-clusterip   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.43")]),t._v(".49.255   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/TCP   11m\n\n$ kubectl get endpoints\nWarning: v1 Endpoints is deprecated "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" v1.33+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" use discovery.k8s.io/v1 EndpointSlice\nNAME                     ENDPOINTS                                      AGE\nhostname-svc-clusterip   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.42")]),t._v(".0.144:80,10.42.0.145:80,10.42.0.146:80   11m\nkubernetes               "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.7:6443                               25d\n")])])]),a("ul",[a("li",[t._v("서비스의 라벨 셀렉터와 포드의 라벨이 매칭되어 연결되면 자동으로 "),a("strong",[t._v("엔드포인트")]),t._v("라는 오브젝트가 생성됨")])]),t._v(" "),a("h2",{attrs:{id:"nodeport"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodeport"}},[t._v("#")]),t._v(" NodePort")]),t._v(" "),a("ul",[a("li",[t._v("모든 노드의 특정 포트를 개방해 서비스에 접근하는 방식")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nodeport\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webserver\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NodePort\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get svc\nNAME                    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("          AGE\nhostname-svc-nodeport   NodePort    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.43")]),t._v(".36.241   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":31294/TCP   4s\n")])])]),a("ul",[a("li",[t._v("clusterip 때 처럼 CLUSTER-IP에 내부 IP가 할당됨 → NodePort 타입의 서비스가 ClusterIP의 기능을 포함하고 있기 때문")]),t._v(" "),a("li",[t._v("하지만 실제 운영 환경에서 NodePort로 서비스를 외부에 제공하는 경우는 많지 않음\n"),a("ul",[a("li",[t._v("포트 번호를 80, 443 으로 설정하기엔 적절하지 않음(기본적으로 NodePort)가 사용할 수 있는 포트 범위는 30000~32768")]),t._v(" "),a("li",[t._v("tls 인증서 적용, 라우팅 등과 같은 복잡한 설정을 서비스에 적용하기 어렵")])])]),t._v(" "),a("li",[t._v("대신 인그레스라는 오브젝트를 통해 간접적으로 사용")])]),t._v(" "),a("h3",{attrs:{id:"sessionaffinity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sessionaffinity"}},[t._v("#")]),t._v(" sessionAffinity")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sessionAffinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClientIP\n")])])]),a("ul",[a("li",[t._v("sessinAffinity 설정으로 Sticky Session 기능 적용 가능")]),t._v(" "),a("li",[t._v("특정 클라이언트의 요청이 같은 Pod에서만 처리되게 할 수 있음")])]),t._v(" "),a("h3",{attrs:{id:"externaltrafficpolicy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#externaltrafficpolicy"}},[t._v("#")]),t._v(" externalTrafficPolicy")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fc6FU0N%2FbtqN2WbMU93%2FAAAAAAAAAAAAAAAAAAAAAEcPxm_j3rhohB6YFlq2BiBFtdmbyPzFq3L2V9ogIMRR%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1761922799%26allow_ip%3D%26allow_referer%3D%26signature%3DcZjvnzKh%252Bep5Jk4LQVbKN9joDPM%253D",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("NodePort, LoadBalancer 타입의 서비스를 사용하면 각 워커 노드로 들어온 요청이 포드 중 하나로 전달됨")]),t._v(" "),a("li",[t._v("하지만 위 그림과 같이 워커0으로 들어온 요청이 다시 워커1의 포드로 전달되는 경우\n"),a("ul",[a("li",[t._v("불필요한 네트워크 홉이 발생함")]),t._v(" "),a("li",[t._v("노드 간의 리다이렉트가 발생하게 되어 트래픽의 출발지 주소가 바뀜 → 클라이언트의 IP 주소가 보존되지 않음")])])]),t._v(" "),a("li",[t._v("이는 "),a("code",[t._v("externalTrafficPolicy")]),t._v("가 "),a("code",[t._v("Cluster")]),t._v("로 설정되어 있기 때문")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get svc hostname-svc-nodeport "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" yaml\napiVersion: v1\nkind: Service\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nspec:\n  externalTrafficPolicy: Cluster\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("ul",[a("li",[t._v("이를 방지하기 위해 externalTrafficPolicy를 "),a("code",[t._v("Local")]),t._v("로 설정 가능 → 포드가 생성된 노드에서만 포드로 접근 가능")]),t._v(" "),a("li",[t._v("그럼 접근한 노드에 포드가 없으면?\n"),a("img",{attrs:{src:"https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FbUj9EV%2FbtqNYwkGAOF%2FAAAAAAAAAAAAAAAAAAAAAOnlPmAZ4Y1mwXWHIcNmdG05yyBJ8ORWIj12hKp8c5UU%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1761922799%26allow_ip%3D%26allow_referer%3D%26signature%3DFAmgALsZjhWzTFBpQvQkU5mSnLg%253D",alt:""}})]),t._v(" "),a("li",[t._v("요청 처리 실패함")])]),t._v(" "),a("p",[t._v("결론\nif 불필요한 네트워크 홉으로 인한 레이턴시나 클라이언트의 IP 보존이 중요하지 않음\n→ Cluster\nelse\n→ Local")]),t._v(" "),a("h3",{attrs:{id:"externalname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#externalname"}},[t._v("#")]),t._v(" ExternalName")]),t._v(" "),a("ul",[a("li",[t._v("ExternalName 타입을 사용해 서비스를 생성하면 서비스가 외부 도메인을 가리키도록 설정할 수 있음")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" externalname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("svc\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ExternalName\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("externalName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my.database.com\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("사용하는 도메인 이름")]),t._v(" "),a("th",[t._v("변환되는 주소")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("externalname-svc")]),t._v(" "),a("td",[t._v("my.database.com")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);