(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{399:function(t,s,a){"use strict";a.r(s);var e=a(28),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_4-serviceaccount와-rbac"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-serviceaccount와-rbac"}},[t._v("#")]),t._v(" 4. ServiceAccount와 RBAC")]),t._v(" "),s("h1",{attrs:{id:"보안을-위한-인증과-인가"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#보안을-위한-인증과-인가"}},[t._v("#")]),t._v(" 보안을 위한 인증과 인가")]),t._v(" "),s("ul",[s("li",[t._v("여러 명의 개발자가 쿠버네티스에 접근 가능")]),t._v(" "),s("li",[t._v("각 개발자가 명령어를 통해 애플리케이션을 동시에 배포할 수도 있음")]),t._v(" "),s("li",[t._v("그렇게 때문에 쿠버네티스도 보안을 고려해야 함")]),t._v(" "),s("li",[t._v("여러 보안 기능이 있는데, RBAC 기반 Service Account라는 기능을 가장 자주 사용")])]),t._v(" "),s("h2",{attrs:{id:"쿠버네티스의-권한-인증-과정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#쿠버네티스의-권한-인증-과정"}},[t._v("#")]),t._v(" 쿠버네티스의 권한 인증 과정")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://user-images.githubusercontent.com/47745785/154834901-ed174911-cbe7-4cda-8f29-e1b493f55a83.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("kubectl 명령어가 실행되면 쿠버네티스 API 서버의 HTTP 핸들러에 요청 전송")]),t._v(" "),s("li",[t._v("API 서버에서는 인증 및 인가 과정 진행 (Service Account 외에도 OAuth, 인증서 등과 같은 다양한 방법 사용 가능)")]),t._v(" "),s("li",[t._v("그 다음에는 어드미션 컨트롤러라는 별도의 단계 처리 후 요청 받은 기능 수행\n"),s("ul",[s("li",[t._v("어드미션 컨트롤러 : 쿠버네티스 클러스터의 보안 강화 및 세부적인 정책 구현")])])])]),t._v(" "),s("h2",{attrs:{id:"service-account"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-account"}},[t._v("#")]),t._v(" Service Account")]),t._v(" "),s("ul",[s("li",[t._v("체계적으로 권한을 관리하기 위한 쿠버네티스 오브젝트")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~$ kubectl get sa\nNAME      SECRETS   AGE\ndefault   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("         72d\n\ndgh0001@rpi4b:~$ kubectl get serviceaccount\nNAME      SECRETS   AGE\ndefault   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("         72d\n")])])]),s("ul",[s("li",[t._v("사용자 또는 애플리케이션 하나에 해당")]),t._v(" "),s("li",[t._v("RBAC라는 기능을 통해 특정 명령을 실행할 수 있는 권한을 서비스 어카운트에 부여")]),t._v(" "),s("li",[t._v("권한을 부여받은 서비스 어카운트는 해당 권한에 해당하는 기능만 사용할 수 있음")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~$ kubectl get svc\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   AGE\nkubernetes   ClusterIP   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.43")]),t._v(".0.1    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/TCP   28d\n\ndgh0001@rpi4b:~$ kubectl get svc "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--as")]),t._v(" system:serviceaccount:default:temp\nError from server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Forbidden"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": services is forbidden: User "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system:serviceaccount:default:temp"')]),t._v(" cannot list resource "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"services"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" API group "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the namespace "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),t._v("\n")])])]),s("ul",[s("li",[t._v("기본적으로는 "),s("code",[t._v("~/.kube/config")]),t._v("라는 파일에 설정된 인증 정보를 통해 쿠버네티스 클러스터를 제어")]),t._v(" "),s("li",[t._v("두 번째 커맨드와 같이 "),s("code",[t._v("--as")]),t._v("로 임시 서비스 어카운트를 사용하여 kubectl 명령어를 실행하면 권한 오류 발생")])]),t._v(" "),s("ul",[s("li",[t._v("적절한 권한을 부여해야만 쿠버네티스 기능 사용 가능")])]),t._v(" "),s("h2",{attrs:{id:"권한-부여-방법"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#권한-부여-방법"}},[t._v("#")]),t._v(" 권한 부여 방법")]),t._v(" "),s("ul",[s("li",[t._v("Role(네임스페이스에 속함), Cluster Role(네임스페이스에 속하지 않음)")])]),t._v(" "),s("h3",{attrs:{id:"role"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#role"}},[t._v("#")]),t._v(" Role")]),t._v(" "),s("ul",[s("li",[t._v("부여할 권한이 무엇인지를 나타내는 쿠버네티스 오브젝트\n"),s("ul",[s("li",[t._v("디플로이먼트를 생성 가능하다, 서비스 목록을 조회한다 등")])])]),t._v(" "),s("li",[s("code",[t._v("kubectl get role")])]),t._v(" "),s("li",[t._v("service-reader-role.yaml")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 대상이 될 오브젝트의 API 그룹")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"services"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 대상이 될 오브젝트의 이름")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"list"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 어떠한 동작을 허용할 것인지 명시")]),t._v("\n")])])]),s("h4",{attrs:{id:"apigroups"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#apigroups"}},[t._v("#")]),t._v(" apiGroups")]),t._v(" "),s("ul",[s("li",[t._v("쿠버네티스의 오브젝트가 가지는 목적에 따라 분류되는 일종의 카테고리")]),t._v(" "),s("li",[s("code",[t._v("kubectl api-resources")]),t._v("로 확인 가능 (APIVERSION 칼럼의 [APIGROUP]/[VERSION])")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~$ kubectl api-resources\nNAME                                SHORTNAMES   APIVERSION                          NAMESPACED   KIND\npods                                po           v1                                  "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("         Pod\nservices                            svc          v1                                  "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("         Service\ndeployments                         deploy       apps/v1                             "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("         Deployment\n")])])]),s("ul",[s("li",[t._v("현재 서비스는 코어 API 그룹에 속하기 때문에 apiGroup이 없음")])]),t._v(" "),s("h4",{attrs:{id:"resources"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resources"}},[t._v("#")]),t._v(" resources")]),t._v(" "),s("ul",[s("li",[t._v("어떤 쿠버네티스 오브젝트에 대해 권한을 정의할 것인지")])]),t._v(" "),s("h4",{attrs:{id:"verbs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#verbs"}},[t._v("#")]),t._v(" verbs")]),t._v(" "),s("ul",[s("li",[t._v("이 롤을 부여받은 대상이 resources에 지정된 오브젝트들에 대해 어떤 동작을 수행할 수 있는지 정의")])]),t._v(" "),s("h3",{attrs:{id:"rolebinding"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rolebinding"}},[t._v("#")]),t._v(" RoleBinding")]),t._v(" "),s("ul",[s("li",[t._v("이렇게 만들어진 롤을 특정 대상에게 부여하려면 Role Binding이라는 오브젝트를 통해 특정 대상과 롤을 연결해야 함")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rolebinding\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 권한을 부여할 대상이 ServiceAccount임")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" temp "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# temp라는 이름을 가진 서비스 어카운트에 권한 부여")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Role에 정의된 권한 부여")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# service-reader라는 이름의 Role을 대상에 연결")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n")])])]),s("ul",[s("li",[t._v("롤 바인딩 적용 후")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("dgh0001@rpi4b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f rolebinding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader.yaml\nrolebinding.rbac.authorization.k8s.io/service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rolebinding created\n\ndgh0001@rpi4b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("~$ kubectl get svc "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("as system"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("serviceaccount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("temp\nNAME         TYPE        CLUSTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP   EXTERNAL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP   PORT(S)   AGE\nkubernetes   ClusterIP   10.43.0.1    <none"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("        443/TCP   28d\n")])])]),s("ul",[s("li",[t._v("서비스 목록을 조회하는 권한을 부여받았기 때문에 정상적으로 명령어 사용 가능")])]),t._v(" "),s("h3",{attrs:{id:"cluster-role"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cluster-role"}},[t._v("#")]),t._v(" Cluster Role")]),t._v(" "),s("ul",[s("li",[t._v("클러스터 단위의 권한을 정의할 때 사용")]),t._v(" "),s("li",[t._v("여러 네임스페이스에서 사용되는 권한을 클러스터 롤로 만들어 쓸 수 있음")]),t._v(" "),s("li",[s("code",[t._v("kubectl get clusterrole")])]),t._v(" "),s("li",[t._v("롤을 사용할 때 처럼 클러스터 롤도 클러스터 롤 바인딩이라는 쿠버네티스 오브젝트를 사용해야 함")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nodes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nodes"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"list"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nodes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("clusterrolebinding\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" temp\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nodes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("reader\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n")])])]),s("ul",[s("li",[t._v("클러스터 롤 생성 및 바인딩 후")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" nodes-reader-clusterrole.yaml\nclusterrole.rbac.authorization.k8s.io/nodes-reader created\n\ndgh0001@rpi4b:~$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" clusterrolebinding-nodes-reader.yaml\nclusterrolebinding.rbac.authorization.k8s.io/nodes-reader-clusterrolebinding created\n\ndgh0001@rpi4b:~$ kubectl get nodes "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--as")]),t._v(" system:serviceaccount:default:temp\nNAME    STATUS   ROLES                  AGE   VERSION\nrpi4b   Ready    control-plane,master   72d   v1.33.4+k3s1\n")])])]),s("ul",[s("li",[t._v("정상적으로 실행 가능")])]),t._v(" "),s("h2",{attrs:{id:"쿠버네티스-api-서버-접근"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#쿠버네티스-api-서버-접근"}},[t._v("#")]),t._v(" 쿠버네티스 API 서버 접근")]),t._v(" "),s("ul",[s("li",[t._v("쿠버네티스 API 서버도 HTTP 요청을 통해 쿠버네티스 기능 사용 가능")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://localhost:6443/apis "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-k")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kind"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Status"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiVersion"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"metadata"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Failure"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Unauthorized"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reason"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Unauthorized"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"code"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("401")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("하지만 일반적인 방식으로는 권한 부족으로 접근 불가능")]),t._v(" "),s("li",[t._v("별도의 인증 정보를 HTTP 페이로드에 포함시켜야 함")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~$ kubectl create token temp\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\ndgh0001@rpi4b:~$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://localhost:6443/apis "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authorization: Bearer ..."')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-k")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kind"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APIGroupList"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiVersion"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"groups"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),s("h2",{attrs:{id:"클러스터-내부에서-쿠버네티스-서비스를-통해-api-서버에-접근"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#클러스터-내부에서-쿠버네티스-서비스를-통해-api-서버에-접근"}},[t._v("#")]),t._v(" 클러스터 내부에서 쿠버네티스 서비스를 통해 API 서버에 접근")]),t._v(" "),s("ul",[s("li",[t._v("쿠버네티스에 기본적으로 존재하고 있는 kubernetes라는 이름의 서비스를 통해 API 사용")])]),t._v(" "),s("h2",{attrs:{id:"쿠버네티스-sdk를-이용해-포드-내부에서-api-서버에-접근"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#쿠버네티스-sdk를-이용해-포드-내부에서-api-서버에-접근"}},[t._v("#")]),t._v(" 쿠버네티스 SDK를 이용해 포드 내부에서 API 서버에 접근")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://user-images.githubusercontent.com/47745785/156710112-57a7c69a-aefe-4090-ae61-34d32afac982.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("포드 내부에서 실행되는 어플리케이션의 경우 특정 언어로 바인딩 된 쿠버네티스 SDK 방식으로도 API 서버에 접근 가능")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_kube_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config_exception"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ConfigException"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    logging"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("warning"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Failed to load kubeconfig."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    exit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napi_client "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CoreV1Api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"kubeconfig-파일에-서비스-어카운트-인증-정보-설정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubeconfig-파일에-서비스-어카운트-인증-정보-설정"}},[t._v("#")]),t._v(" kubeconfig 파일에 서비스 어카운트 인증 정보 설정")]),t._v(" "),s("ul",[s("li",[t._v("kubectl 명령어를 통해 쿠버네티스 클러스터를 제어할 때는 kubeconfig라는 파일을 통해 인증 진행")]),t._v(" "),s("li",[t._v("크게 clusters, users, contexts로 이루어져 있음\n"),s("ul",[s("li",[t._v("clusters : 쿠버네티스 API 서버의 접속 정보 목록")]),t._v(" "),s("li",[t._v("users : 쿠버네티스 API 서버에 접속하기 위한 사용자 인증 정보 목록")]),t._v(" "),s("li",[t._v("contexts: cluster와 users를 조합해 컨텍스트 정의 (ex. cluster A에 user a로 인증해 쿠버네티스 사용)")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);