(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{402:function(t,s,a){"use strict";a.r(s);var e=a(28),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_3-pv와-pvc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-pv와-pvc"}},[t._v("#")]),t._v(" 3. PV와 PVC")]),t._v(" "),s("p",[t._v("쿠버네티스에서도 도커와 같이 호스트에 위치한 디렉터리를 각 포드와 공유함으로써 데이터를 보존하는 것이 가능\n"),s("br"),t._v("\n그렇지만 쿠버네티스와 같이 다중 서버로 구성된 환경에서는 적합하지 않음\n"),s("br")]),t._v(" "),s("p",[t._v("→ 그럴 때 사용하는 것이 PV(Persistent Volume)")]),t._v(" "),s("h2",{attrs:{id:"pv"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pv"}},[t._v("#")]),t._v(" PV")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://images.velog.io/images/ynsoo1225/post/1f9cb034-6a0b-4773-a4ed-9c1a2f6db778/655C45BC-85C5-4976-91D0-9840D045B2A8.jpeg",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("워커 노드들이 네트워크상에서 스토리지를 마운트해 영속적으로 데이터를 저장할 수 있는 볼륨")]),t._v(" "),s("li",[t._v("포드에 장애가 생겨 다른 노드로 옮겨가더라도 해동 노드에서 PV에 네트워크로 연결해 데이터를 계속 사용 가능")])]),t._v(" "),s("h2",{attrs:{id:"nfs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nfs"}},[t._v("#")]),t._v(" NFS")]),t._v(" "),s("ul",[s("li",[t._v("여러 서버 혹은 Pod에서 동시에 접근 가능한 파일 시스템을 NFS(Network File System)이라 함")])]),t._v(" "),s("h2",{attrs:{id:"nfs를-네트워크-볼륨으로-사용하기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nfs를-네트워크-볼륨으로-사용하기"}},[t._v("#")]),t._v(" NFS를 네트워크 볼륨으로 사용하기")]),t._v(" "),s("h3",{attrs:{id:"호스트-raspberry-pi-에-직접-nfs-서버-설치-후-연결"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#호스트-raspberry-pi-에-직접-nfs-서버-설치-후-연결"}},[t._v("#")]),t._v(" 호스트(Raspberry Pi)에 직접 NFS 서버 설치 후 연결")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("container\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tail"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-f"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/dev/null"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("volume\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /mnt\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("volume\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nfs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/export/nfs"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.7\n")])])]),s("ul",[s("li",[t._v("AWS나 GCP에서 제공하는 NFS 사용해도 됨")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~/study$ kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" nfs-pod -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n/ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# df -h")]),t._v("\nFilesystem                 Size      Used Available Use% Mounted on\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.7:/export/nfs  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("219")]),t._v(".6G     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(".2G    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("182")]),t._v(".5G  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("% /mnt\n")])])]),s("h2",{attrs:{id:"pv와-pvc를-이용한-볼륨-관리"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pv와-pvc를-이용한-볼륨-관리"}},[t._v("#")]),t._v(" PV와 PVC를 이용한 볼륨 관리")]),t._v(" "),s("ul",[s("li",[t._v("위 방식으로 NFS를 바로 명시해서 사용하면 서로 밀접하게 연관되어 있어 서로 분리할 수 없어짐")]),t._v(" "),s("li",[t._v("이를 해결하기 위해 PV와 PVC 사용\n"),s("img",{attrs:{src:"https://user-images.githubusercontent.com/47745785/149604997-5971fc24-edbd-48bd-9d6f-024a6c76693e.png",alt:""}})])]),t._v(" "),s("ol",[s("li",[t._v("인프라 관리자가 네트워크 볼륨 서버로 PV 리소스를 미리 생성")]),t._v(" "),s("li",[t._v('사용자(개발자)가 포드를 정의하는 YAML 파일 등에 "영속적인 데이터 저장을 위한 외부 볼륨이 필요함"을 명시 후 해당 PVC 생성')]),t._v(" "),s("li",[t._v("쿠버네티스가 기존에 생성해뒀던 PV의 속성과 사용자가 요청한 PVC의 요구 사항이 일치하면 두 리소스를 매칭시켜 바인딩함")])]),t._v(" "),s("ul",[s("li",[t._v("즉, 사용자는 디플로이먼트의 YAML 파일에서 볼륨의 상세한 스펙을 정의하지 않아도 됨")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Before")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("volume\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nfs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("NFS_SERVER_IP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# After")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("volume\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeClaim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("claimName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mtpvc\n")])])]),s("h2",{attrs:{id:"pv와-pvc-사용하기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pv와-pvc-사용하기"}},[t._v("#")]),t._v(" PV와 PVC 사용하기")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolume\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pv\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("capacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10Gi\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nfs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/export/nfs"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.7\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nfsvers=4\n")])])]),s("h3",{attrs:{id:"pvc-생성-후-pod-생성-시-pvc적용"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pvc-생성-후-pod-생성-시-pvc적용"}},[t._v("#")]),t._v(" PVC 생성 후 Pod 생성 시 PVC적용")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolumeClaim\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pvc\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storageClassName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 조건 1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5Gi "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 조건 2")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("container\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tail"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-f"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/dev/null"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("volume\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /mnt\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("volume\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeClaim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("claimName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pvc\n")])])]),s("h3",{attrs:{id:"실행-결과"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#실행-결과"}},[t._v("#")]),t._v(" 실행 결과")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~/study$ kubectl get pv,pvc\nNAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS\npersistentvolume/nfs-pv                                     10Gi       RWX            Retain           Bound\n\nNAME                              STATUS    VOLUME                                     CAPACITY   ACCESS MODES\npersistentvolumeclaim/my-pvc      Bound     nfs-pv                                     10Gi       RWX\n")])])]),s("ul",[s("li",[t._v("PV와 PVC의 상태(STATUS)가 Bound로 설정되어 있으면 정상적으로 마운트 된 상태")])]),t._v(" "),s("p",[s("strong",[t._v("PV와 PVC의 차이 - 네임스페이스")])]),t._v(" "),s("ul",[s("li",[t._v("PV는 네임스페이스에 속하지 않는 클러스터 단위의 오브젝트")]),t._v(" "),s("li",[t._v("PVC는 네임스페이스에 속하는 클러스터 단위의 오브젝트")])]),t._v(" "),s("h2",{attrs:{id:"pv를-선택하기-위한-조건들"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pv를-선택하기-위한-조건들"}},[t._v("#")]),t._v(" PV를 선택하기 위한 조건들")]),t._v(" "),s("h3",{attrs:{id:"accessmodes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#accessmodes"}},[t._v("#")]),t._v(" accessModes")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("accessModes 이름")]),t._v(" "),s("th",[t._v("설명")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ReadWriteOnce")]),t._v(" "),s("td",[t._v("1:1 마운트만 가능, 읽기 쓰기 가능")])]),t._v(" "),s("tr",[s("td",[t._v("ReadOnlyMany")]),t._v(" "),s("td",[t._v("1:N 마운트 가능, 읽기 전용")])]),t._v(" "),s("tr",[s("td",[t._v("ReadWriteMany")]),t._v(" "),s("td",[t._v("1:N 마운트 가능, 읽기 쓰기 가능")])])])]),t._v(" "),s("ul",[s("li",[t._v("사용하는 NFS 종류에 따라 다름(ex. EBS는 1:1 관계의 마운트만 가능)")]),t._v(" "),s("li",[t._v("그 외에도 볼륨의 크기, 스토리지 클래스, 라벨 셀렉터 등이 있음")])]),t._v(" "),s("h2",{attrs:{id:"pv의-라이프사이클과-reclaim-policy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pv의-라이프사이클과-reclaim-policy"}},[t._v("#")]),t._v(" PV의 라이프사이클과 Reclaim Policy")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~/study$ kubectl delete "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" nfs-pod.yaml\npersistentvolumeclaim "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-pvc"')]),t._v(" deleted from default namespace\n\ndgh0001@rpi4b:~/study$ kubectl get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pv")]),t._v("\nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS\nnfs-pv                                     10Gi       RWX            Retain           Released\n")])])]),s("ul",[s("li",[t._v("Available → Bound → Released")]),t._v(" "),s("li",[t._v("Released는 해당 PV의 사용이 끝났지만, 실제 데이터들이 안에 Retain이라는 Reclaim Policy로 보존되어 있기 때문에 다시 사용 불가능함")])]),t._v(" "),s("h3",{attrs:{id:"retain-policy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#retain-policy"}},[t._v("#")]),t._v(" Retain Policy")]),t._v(" "),s("ul",[s("li",[t._v("PVC 삭제 시 PV의 데이터를 어떻게 처리할 것인지 별도로 정의 가능")]),t._v(" "),s("li",[t._v("보통은 데이터를 영구적으로 저장하기 위해 "),s("code",[t._v("Retain")]),t._v(" 옵션 사용")]),t._v(" "),s("li",[s("code",[t._v("Delete")]),t._v(" 사용 시 자동으로 PV까지 삭제")]),t._v(" "),s("li",[s("code",[t._v("Recycle")]),t._v(" 사용 시 PV의 데이터를 모두 삭제한 후 다시 Available 상태로 만들어줌 (Deprecated 예정)")])]),t._v(" "),s("h2",{attrs:{id:"다이나믹-프로비저닝과-스토리지-클래스"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#다이나믹-프로비저닝과-스토리지-클래스"}},[t._v("#")]),t._v(" 다이나믹 프로비저닝과 스토리지 클래스")]),t._v(" "),s("ul",[s("li",[t._v("PV를 사용하려면 미리 외부 스토리지를 준비해야 햇음")]),t._v(" "),s("li",[t._v("쿠버네티스는 다이나믹 프로비저닝을 통해 PVC와 일치하는 PV가 존재하지 않으면 자동으로 PV와 외부 스토리지를 함께 프로비저닝 함\n"),s("img",{attrs:{src:"https://user-images.githubusercontent.com/47745785/151692828-7e551d9c-1e62-4785-a67e-1535aa70ebc6.png",alt:""}})]),t._v(" "),s("li",[t._v("위 그림과 같이 만족하는 PV가 없으면 스토리지 클래스에 정의된 속성에 따라 외부 스토리지 생성")]),t._v(" "),s("li",[t._v("다이나믹 프로비저닝 기능을 사용하기 위해서는 미리 해당 기능이 지원되는 스토리지 프로비저너가 활성화되어 있어야 함")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" storage.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" StorageClass\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provisioner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs.csi.k8s.io\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parameters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.7\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("share")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/export/nfs"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reclaimPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Delete\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolumeClaim\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pvc\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storageClassName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5Gi\n")])])]),s("h3",{attrs:{id:"결과"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#결과"}},[t._v("#")]),t._v(" 결과")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~/study$ kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" pvc-test.yaml\npersistentvolumeclaim/test-pvc created\n\ndgh0001@rpi4b:~/study$ kubectl get pv,pvc\nNAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM              STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE\npersistentvolume/pvc-c228acb2-7053-44d4-a499-8b469d5d96c1   5Gi        RWX            Delete           Bound    default/test-pvc   "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("unset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                          11s\n\nNAME                             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE\npersistentvolumeclaim/test-pvc   Bound    pvc-c228acb2-7053-44d4-a499-8b469d5d96c1   5Gi        RWX            "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("unset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("                 14s\n")])])]),s("h3",{attrs:{id:"특정-스토리지-클래스-기본값으로-사용"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#특정-스토리지-클래스-기본값으로-사용"}},[t._v("#")]),t._v(" 특정 스토리지 클래스 기본값으로 사용")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" storage.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" StorageClass\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("annotations")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storageclass.kubernetes.io/is-default-class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provisioner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs.csi.k8s.io\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parameters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.7\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("share")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/export/nfs"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reclaimPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Delete\n")])])]),s("ul",[s("li",[t._v("어노테이션 추가로 사용할 디폴트 스토리지 클래스 설정 가능")])]),t._v(" "),s("h3",{attrs:{id:"결과-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#결과-2"}},[t._v("#")]),t._v(" 결과")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("dgh0001@rpi4b:~/study$ kubectl get sc\nNAME             PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   nfs.csi.k8s.io   Delete          Immediate           "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("                  73s\n")])])]),s("ul",[s("li",[t._v("별도로 스토리지 클래스 명시 안하면 자동으로 기본 설정된 스토리지 클래스를 통해 다이나믹 프로비저닝 수행")])])])}),[],!1,null,null,null);s.default=n.exports}}]);