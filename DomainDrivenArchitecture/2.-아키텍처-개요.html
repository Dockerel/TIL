<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2. 아키텍처 개요 | Today Dockerel Learned</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/TIL/logo.png">
    <meta name="description" content="Dockerel&#39;s Personal Wiki (Today I Learned)">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.40dd5a95.css" as="style"><link rel="preload" href="/TIL/assets/js/app.0619190b.js" as="script"><link rel="preload" href="/TIL/assets/js/2.188c950f.js" as="script"><link rel="preload" href="/TIL/assets/js/1.a1e51968.js" as="script"><link rel="preload" href="/TIL/assets/js/48.de028b34.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.e6f03b60.js"><link rel="prefetch" href="/TIL/assets/js/11.0fba4bf3.js"><link rel="prefetch" href="/TIL/assets/js/12.181bd7bc.js"><link rel="prefetch" href="/TIL/assets/js/13.c5707e1c.js"><link rel="prefetch" href="/TIL/assets/js/14.b086a433.js"><link rel="prefetch" href="/TIL/assets/js/15.3e75d743.js"><link rel="prefetch" href="/TIL/assets/js/16.a2bc07a8.js"><link rel="prefetch" href="/TIL/assets/js/17.788e0b87.js"><link rel="prefetch" href="/TIL/assets/js/18.c240daa0.js"><link rel="prefetch" href="/TIL/assets/js/19.60958448.js"><link rel="prefetch" href="/TIL/assets/js/20.4352d5d9.js"><link rel="prefetch" href="/TIL/assets/js/21.8fb87d52.js"><link rel="prefetch" href="/TIL/assets/js/22.664a6cc8.js"><link rel="prefetch" href="/TIL/assets/js/23.5ae71a00.js"><link rel="prefetch" href="/TIL/assets/js/24.c5858c7d.js"><link rel="prefetch" href="/TIL/assets/js/25.1aeaac43.js"><link rel="prefetch" href="/TIL/assets/js/26.966808ab.js"><link rel="prefetch" href="/TIL/assets/js/27.41f28bb0.js"><link rel="prefetch" href="/TIL/assets/js/28.37ba8758.js"><link rel="prefetch" href="/TIL/assets/js/29.69de06de.js"><link rel="prefetch" href="/TIL/assets/js/3.e9de9cb1.js"><link rel="prefetch" href="/TIL/assets/js/30.c81725f0.js"><link rel="prefetch" href="/TIL/assets/js/31.39ce7d2d.js"><link rel="prefetch" href="/TIL/assets/js/32.5fd280ec.js"><link rel="prefetch" href="/TIL/assets/js/33.27f9c496.js"><link rel="prefetch" href="/TIL/assets/js/34.c2abcd24.js"><link rel="prefetch" href="/TIL/assets/js/35.bd335bb3.js"><link rel="prefetch" href="/TIL/assets/js/36.7c2d0c6f.js"><link rel="prefetch" href="/TIL/assets/js/37.90b10f8f.js"><link rel="prefetch" href="/TIL/assets/js/38.9411f06d.js"><link rel="prefetch" href="/TIL/assets/js/39.0f5cd554.js"><link rel="prefetch" href="/TIL/assets/js/4.c5b6f970.js"><link rel="prefetch" href="/TIL/assets/js/40.e97f59db.js"><link rel="prefetch" href="/TIL/assets/js/41.6305b7cd.js"><link rel="prefetch" href="/TIL/assets/js/42.9afe14b6.js"><link rel="prefetch" href="/TIL/assets/js/43.724770cd.js"><link rel="prefetch" href="/TIL/assets/js/44.2adb638a.js"><link rel="prefetch" href="/TIL/assets/js/45.bcfb7b68.js"><link rel="prefetch" href="/TIL/assets/js/46.b69bd46b.js"><link rel="prefetch" href="/TIL/assets/js/47.1f1bd163.js"><link rel="prefetch" href="/TIL/assets/js/49.5c305da2.js"><link rel="prefetch" href="/TIL/assets/js/5.5e20f558.js"><link rel="prefetch" href="/TIL/assets/js/50.04bd63af.js"><link rel="prefetch" href="/TIL/assets/js/51.c7dc238d.js"><link rel="prefetch" href="/TIL/assets/js/52.5b99f815.js"><link rel="prefetch" href="/TIL/assets/js/53.876bb230.js"><link rel="prefetch" href="/TIL/assets/js/54.63442310.js"><link rel="prefetch" href="/TIL/assets/js/55.e25e9470.js"><link rel="prefetch" href="/TIL/assets/js/56.31674b5b.js"><link rel="prefetch" href="/TIL/assets/js/57.44dc5c05.js"><link rel="prefetch" href="/TIL/assets/js/58.a01582ba.js"><link rel="prefetch" href="/TIL/assets/js/59.2b2e1bfd.js"><link rel="prefetch" href="/TIL/assets/js/6.e8a6e3a8.js"><link rel="prefetch" href="/TIL/assets/js/60.cd2bec61.js"><link rel="prefetch" href="/TIL/assets/js/61.a96c05a5.js"><link rel="prefetch" href="/TIL/assets/js/62.e097350c.js"><link rel="prefetch" href="/TIL/assets/js/63.6845d699.js"><link rel="prefetch" href="/TIL/assets/js/64.c8934f45.js"><link rel="prefetch" href="/TIL/assets/js/65.cce0c2b8.js"><link rel="prefetch" href="/TIL/assets/js/66.4f7cb27a.js"><link rel="prefetch" href="/TIL/assets/js/67.b6640c60.js"><link rel="prefetch" href="/TIL/assets/js/68.15d4d163.js"><link rel="prefetch" href="/TIL/assets/js/69.3b150e3c.js"><link rel="prefetch" href="/TIL/assets/js/7.7fea5211.js"><link rel="prefetch" href="/TIL/assets/js/70.28717890.js"><link rel="prefetch" href="/TIL/assets/js/71.a39e9166.js"><link rel="prefetch" href="/TIL/assets/js/72.b6a8e4d4.js"><link rel="prefetch" href="/TIL/assets/js/vendors~docsearch.68e379d9.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.40dd5a95.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">Today Dockerel Learned</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Dockerel/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dockerel.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Dockerel/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dockerel.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Backend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>DomainDrivenArchitecture</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/DomainDrivenArchitecture/1.-도메인-모델-시작하기.html" class="sidebar-link">1. 도메인 모델 시작하기</a></li><li><a href="/TIL/DomainDrivenArchitecture/2.-아키텍처-개요.html" class="active sidebar-link">2. 아키텍처 개요</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/2.-아키텍처-개요.html#_2-1-네-개의-영역" class="sidebar-link">2.1 네 개의 영역</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/2.-아키텍처-개요.html#_2-2-계층-구조-아키텍처" class="sidebar-link">2.2 계층 구조 아키텍처</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/2.-아키텍처-개요.html#_2-3-dip" class="sidebar-link">2.3 DIP</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/2.-아키텍처-개요.html#_2-4-도메인-영역의-주요-구성요소" class="sidebar-link">2.4 도메인 영역의 주요 구성요소</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/2.-아키텍처-개요.html#_2-5-요청-처리-흐름" class="sidebar-link">2.5 요청 처리 흐름</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/2.-아키텍처-개요.html#_2-6-인프라스트럭처-개요" class="sidebar-link">2.6 인프라스트럭처 개요</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/2.-아키텍처-개요.html#_2-7-모듈-구성" class="sidebar-link">2.7 모듈 구성</a></li></ul></li><li><a href="/TIL/DomainDrivenArchitecture/3.-애그리거트.html" class="sidebar-link">3. 애그리거트</a></li><li><a href="/TIL/DomainDrivenArchitecture/4.-리포지터리와-모델-구현.html" class="sidebar-link">4. 리포지터리와 모델 구현</a></li><li><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html" class="sidebar-link">5. 스프링 데이터 JPA를 이용한 조회 기능</a></li><li><a href="/TIL/DomainDrivenArchitecture/6.-응용-서비스와-표현-영역.html" class="sidebar-link">6. 응용 서비스와 표현 영역</a></li><li><a href="/TIL/DomainDrivenArchitecture/7.-도메인-서비스.html" class="sidebar-link">7. 도메인 서비스</a></li><li><a href="/TIL/DomainDrivenArchitecture/8.-애그리거트-트랜잭션-관리.html" class="sidebar-link">8. 애그리거트 트랜잭션 관리</a></li><li><a href="/TIL/DomainDrivenArchitecture/9.-도메인-모델과-경계.html" class="sidebar-link">9. 도메인 모델과 경계</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OperatingSystem</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2-아키텍처-개요"><a href="#_2-아키텍처-개요" class="header-anchor">#</a> 2. 아키텍처 개요</h1> <h2 id="_2-1-네-개의-영역"><a href="#_2-1-네-개의-영역" class="header-anchor">#</a> 2.1 네 개의 영역</h2> <h3 id="표현"><a href="#표현" class="header-anchor">#</a> 표현</h3> <ul><li>웹 브라우저 ⇆ 표현</li> <li>응용 영역이 필요로 하는 형식으로 HTTP 요청을 변환해서 전달</li> <li>응용 영역의 응답을 HTTP 응답으로 변환하여 전송</li></ul> <h3 id="응용"><a href="#응용" class="header-anchor">#</a> 응용</h3> <ul><li>응용 ⇆ 도메인(엔티티, 값)</li> <li>기능을 구현하기 위해 도메인 영역의 도메인 모델 사용</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CancelOrderService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancelOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token function">findOrderById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OrderNotFoundException</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위 코드처럼 도메인 모델에 로직 위임</li></ul> <h3 id="도메인"><a href="#도메인" class="header-anchor">#</a> 도메인</h3> <ul><li>도메인의 핵심 로직 구현</li> <li>ex) 배송지 변경, 주문 취소 등</li></ul> <h3 id="인프라스트럭처"><a href="#인프라스트럭처" class="header-anchor">#</a> 인프라스트럭처</h3> <ul><li>구현 기술 처리</li> <li>ex) RDBMS 연동, 메시징 큐에 메시지 송/수신 등</li> <li>논리적인 개념 표현보다는 실제 구현</li></ul> <h3 id="정리"><a href="#정리" class="header-anchor">#</a> 정리</h3> <ul><li>각 계층은 구현 기술을 사용한 코드를 직접 만들지 않고</li> <li>인프라스트럭처 영역에서 제공하는 기능을 사용해서 필요한 기능 개발</li></ul> <h2 id="_2-2-계층-구조-아키텍처"><a href="#_2-2-계층-구조-아키텍처" class="header-anchor">#</a> 2.2 계층 구조 아키텍처</h2> <h3 id="계층-구조의-아키텍처-구성"><a href="#계층-구조의-아키텍처-구성" class="header-anchor">#</a> 계층 구조의 아키텍처 구성</h3> <ul><li>표현 → 응용 → 도메인 → 인프라스트럭처</li> <li>상위 계층에서 하위 계층으로의 의존만 존재해야</li> <li>하지만 구현의 편리함을 위해 계층 구조 유연하게 적용하기도 함</li> <li>ex) 외부 시스템과의 연동을 위해 응용 계층이 인프라스트럭처에 의존하기도 함</li> <li>그러나 만약 다른 구현 기술을 사용하게 되면 코드의 많은 부분을 고치게 됨</li></ul> <h3 id="인프라스트럭처에-의존하면"><a href="#인프라스트럭처에-의존하면" class="header-anchor">#</a> 인프라스트럭처에 의존하면?</h3> <ol><li>테스트 어려워짐</li> <li>기능 확장 어려워짐
→ DIP로 해결</li></ol> <h2 id="_2-3-dip"><a href="#_2-3-dip" class="header-anchor">#</a> 2.3 DIP</h2> <ul><li>고수준 모듈 (응용 영역)이 저수준 모듈 (인프라스트럭처) 모듈에 의존하도록 바꾸려면 <strong>추상화한 인터페이스 사용</strong></li></ul> <h3 id="ex"><a href="#ex" class="header-anchor">#</a> ex</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RuleDiscounter</span> <span class="token punctuation">{</span>
    <span class="token class-name">Money</span> <span class="token function">applyRules</span><span class="token punctuation">(</span><span class="token class-name">Customer</span> customer<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderLine</span><span class="token punctuation">&gt;</span></span> orderLines<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CalculateDiscountService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">RuleDiscounter</span> ruleDiscounter<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Money</span> <span class="token function">calculateDiscount</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderLine</span><span class="token punctuation">&gt;</span></span> orderLines<span class="token punctuation">,</span> <span class="token class-name">String</span> customerId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Customer</span> customer <span class="token operator">=</span> <span class="token function">findCustomer</span><span class="token punctuation">(</span>customerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ruleDiscounter<span class="token punctuation">.</span><span class="token function">applyRUles</span><span class="token punctuation">(</span>customer<span class="token punctuation">,</span> orderLines<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>→ 룰 적용을 구현한 클래스는 <strong>RuleDiscounter 인터페이스를 상속</strong>받아 구현</p> <ul><li>저수준 모듈(RuleDiscounted의 구현체)이 고수준 모듈(RuleDiscounter 인터페이스)에 의존하게 됨 (DIP, Dependency Inversion Principle, 의존 역전 원칙)</li></ul> <h3 id="장점"><a href="#장점" class="header-anchor">#</a> 장점</h3> <ol><li>구현 기술 교체가 쉬워짐</li> <li>테스트하기 쉬워짐 (Mock, Stub 등 주입)</li></ol> <h3 id="dip-주의사항"><a href="#dip-주의사항" class="header-anchor">#</a> DIP 주의사항</h3> <ul><li>하위 기능을 추상화한 인터페이스는 <strong>고수준 모듈 관점에서 도출하기</strong></li></ul> <blockquote><p>Q. 그럼 인프라스트럭처 계층을 추상화한 인터페이스의 정의 위치는 응용 패키지에 두어야 함?</p></blockquote> <h3 id="dip와-아키텍처"><a href="#dip와-아키텍처" class="header-anchor">#</a> DIP와 아키텍처</h3> <ul><li>아키텍처에 DIP를 적용하면</li></ul> <p><img src="https://assu10.github.io/assets/img/dev/2024/0401/dip_architecture.png" alt=""></p> <ul><li>위 사진과 같이 인프라 스트럭처 영역이 응용 영역과 도메인 영역에 의존하게 됨
→ 인프라스트럭처에 위치한 클래스가 도메인과 응용 영역에 영향을 주지 않거나 최소화하면서 구현 기술을 변경하는 것이 가능해짐</li></ul> <blockquote><p>[OrderService -&gt; Notifier(interface)] (응용) &lt;- <a href="%EC%9D%B8%ED%94%84%EB%9D%BC%EC%8A%A4%ED%8A%B8%EB%9F%AD%EC%B2%98">EmailNotifier</a></p> <p>Q. 여기서(P.78) SMS로도 알림이 가야한다 라는 요구사항이 추가되면 Notifier 인터페이스를 인프라스트럭처에 구현하면 된다는걸 알겟는데 그럼 둘다 전송한다 이건 어떻게 구현하지?
여러 Notifier를 한 번에 다루는 Composite 패턴 적용
스프링 같은 경우는 그럼 어떤 빈을 받을 지 어케 알지
Qualifier나 Primary 사용 혹은 @Bean 사용?</p></blockquote> <p>→ 무조건 DIP 를 적용할 필요는 없고 구현 기술에 의존적인 코드를 도메인에 일부 포함하는게 효과적일 때도 있고, 추상화 대상이 잘 안떠오를 수도 있음. DIP의 이점을 얻는 수준에서 적용 범위 검토해보기. 오히려 오버 엔지니어링이 될 수도 있음</p> <ul><li>구현체가 한 종류만 존재하거나, 기술 변경 가능성이 극히 낮은 경우</li> <li>추상화를 도입하면 오히려 코드가 과도하게 복잡해지고 생산성이 떨어지는 경우</li> <li>추상화 대상의 인터페이스 자체가 명확하지 않거나, 불필요하게 느껴지는 경우</li></ul> <h2 id="_2-4-도메인-영역의-주요-구성요소"><a href="#_2-4-도메인-영역의-주요-구성요소" class="header-anchor">#</a> 2.4 도메인 영역의 주요 구성요소</h2> <h3 id="도메인-영역의-주요-구성요소"><a href="#도메인-영역의-주요-구성요소" class="header-anchor">#</a> 도메인 영역의 주요 구성요소</h3> <table><thead><tr><th>요소</th> <th>설명</th></tr></thead> <tbody><tr><td><strong>엔티티 (ENTITY)</strong></td> <td>고유의 식별자를 갖는 객체. 도메인의 고유한 개념 표현. 도메인 모델의 데이터를 포함하며 해당 데이터와 관련된 기능을 함께 제공</td></tr> <tr><td><strong>밸류 (VALUE)</strong></td> <td>고유의 식별자를 갖지 않는 객체. 주소나 금액과 같은 개념적으로 하나인 값. 다른 밸류 타입의 속성으로도 사용할 수 있음</td></tr> <tr><td><strong>애그리거트 (AGGREGATE)</strong></td> <td>연관된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것. Order 엔티티 + OrderLine 밸류 + Orderer 밸류 객체를 '주문' 애그리거트로 묶을 수 있음</td></tr> <tr><td><strong>리포지터리 (REPOSITORY)</strong></td> <td>도메인 모델의 영속성을 처리</td></tr> <tr><td><strong>도메인 서비스 (DOMAIN SERVICE)</strong></td> <td>특정 엔티티에 속하지 않은 도메인 로직 제공. '할인 금액 계산'은 상품, 쿠폰, 회원 등금, 구매 금액 등 다양한 조건을 이용해서 구현하는데, 이때 도메인 서비스에서 로직 구현</td></tr></tbody></table> <h3 id="_2-4-1-엔티티와-밸류"><a href="#_2-4-1-엔티티와-밸류" class="header-anchor">#</a> 2.4.1 엔티티와 밸류</h3> <h4 id="도메인-모델의-엔티티"><a href="#도메인-모델의-엔티티" class="header-anchor">#</a> 도메인 모델의 엔티티</h4> <ul><li>데이터와 함께 기능을 제공하는 객체</li> <li>도메인 관점에서 기능 구현 및 기능 구현을 캡슐화</li> <li>두 개 이상의 데이터가 개념적으로 하나인 경우 밸류 타입을 이용해서 표현</li></ul> <h3 id="애그리거트"><a href="#애그리거트" class="header-anchor">#</a> 애그리거트</h3> <ul><li>관련 객체를 하나로 묶은 군집</li> <li>ex) 주문 = 주문 + 배송지 정보 + 주문자 + 주문 목록</li> <li>도메인 모델에서 전체 구조를 이해하는데 도움이 됨</li> <li>루트 엔티티가 애그리거트가 구현해야 할 기능 제공
<img src="https://velog.velcdn.com/images/bienlee/post/d88debdd-c56f-4f49-b343-69f0af1195c0/image.png" alt=""></li> <li>애그리거트 루트인 Order가 애그리거트에 속한 객체 관리</li> <li>ex) 배송지 정보를 변경할 때에는 Order가 구현한 도메인 로직을 항상 따르도록 구현</li></ul> <h3 id="리포지터리"><a href="#리포지터리" class="header-anchor">#</a> 리포지터리</h3> <ul><li>애그리거트 단위로 도메인 객체를 저장 / 조회</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderRepository</span> <span class="token punctuation">{</span>

    <span class="token class-name">Order</span> <span class="token function">findByNumber</span><span class="token punctuation">(</span><span class="token class-name">OrderNumber</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChangeOrderAddressService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">OrderRepository</span> orderRepository<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeAddress</span><span class="token punctuation">(</span><span class="token class-name">OrderNumber</span> number<span class="token punctuation">,</span> <span class="token class-name">Address</span> address<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> orderRepository<span class="token punctuation">.</span><span class="token function">findByNumber</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoOrderException</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">changeAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>응용 서비스는 의존 주입과 같은 방식으로 실제 리포지터리 객체에 접근
<img src="https://velog.velcdn.com/images/xyzw/post/f603a330-7035-453c-8d02-326c24798a68/image.png" alt=""></li></ul> <h2 id="_2-5-요청-처리-흐름"><a href="#_2-5-요청-처리-흐름" class="header-anchor">#</a> 2.5 요청 처리 흐름</h2> <p><img src="https://user-images.githubusercontent.com/43809168/97808100-1d80dd00-1ca8-11eb-8d8b-8c530d0a8fb4.png" alt=""></p> <ul><li>응용 서비스에서 도메인 상태 변경 시 변경 상태가 올바르게 반영되도록 트랜잭션을 잘 관리해야 함</li></ul> <h2 id="_2-6-인프라스트럭처-개요"><a href="#_2-6-인프라스트럭처-개요" class="header-anchor">#</a> 2.6 인프라스트럭처 개요</h2> <ul><li>다른 영역에서 필요로 하는 프레임워크, 구현 기술, 보조 기능 지원</li> <li>ex) 도메인 객체의 영속성 처리, 트랜잭션, SMTP, REST 클라이언트 등</li> <li>응용 / 도메인 영역에서 정의한 인터페이스를 인프라스트럭처에서 구현하는게 더 유연하고 테스트하기 쉬워짐</li> <li>그렇다고 무조건 인프라스트럭처에 대한 의존을 없앨 필요는 없음</li> <li>ex) 엔티티단에 <code>@Entity</code>, <code>@Table</code>과 같은 JPA 전용 애너테이션 사용</li> <li>결국 (변경의 유연함) + (테스트 쉬움) + (구현의 편리함) 셋을 모두 고려해서 적당한 선에서 구현하기</li> <li>ex) @Transactional 애너테이션</li></ul> <h2 id="_2-7-모듈-구성"><a href="#_2-7-모듈-구성" class="header-anchor">#</a> 2.7 모듈 구성</h2> <ul><li>도메인이 크면 하위 도메인 별로 모듈 나누기</li> <li>도메인 모듈은 도메인에 속한 애그리거트를 기준으로 다시 패키지 구성
<img src="https://user-images.githubusercontent.com/43809168/97808218-00004300-1ca9-11eb-98c0-a9c49efbcde2.png" alt=""></li> <li>애그리거트, 모델, 리포지터리는 같은 패키지에 위치</li> <li>도메인이 복잡하면 도메인 모델과 도메인 서비스를 별도 패키지에 위치시킬 수 있음</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>com.myshop.order.domain.order      // 도메인 모델 위치
    ├── Order.java
    └── OrderLine.java

com.myshop.order.domain.service    // 도메인 서비스 위치
    ├── OrderService.java
    └── DiscountService.java
</code></pre></div><h4 id="ex-도메인-모델"><a href="#ex-도메인-모델" class="header-anchor">#</a> ex 도메인 모델</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// com.myshop.order.domain.order.Order.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderLine</span><span class="token punctuation">&gt;</span></span> orderLines<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> orderLines<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">OrderLine</span><span class="token operator">::</span><span class="token function">getAmount</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ex-도메인-서비스"><a href="#ex-도메인-서비스" class="header-anchor">#</a> ex 도메인 서비스</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// com.myshop.order.domain.service.OrderService.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">calculateDiscount</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">100_000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">10_000</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>응용 서비스도 도메인 별로 패키지 구분 가능</li> <li>정해진 규칙은 없지만 저자는 한 패키지에 10~15개 미만으로 타입 개수를 유지하고 넘어가면 패키지 분리</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/DomainDrivenArchitecture/1.-도메인-모델-시작하기.html" class="prev">
        1. 도메인 모델 시작하기
      </a></span> <span class="next"><a href="/TIL/DomainDrivenArchitecture/3.-애그리거트.html">
        3. 애그리거트
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.0619190b.js" defer></script><script src="/TIL/assets/js/2.188c950f.js" defer></script><script src="/TIL/assets/js/1.a1e51968.js" defer></script><script src="/TIL/assets/js/48.de028b34.js" defer></script>
  </body>
</html>
