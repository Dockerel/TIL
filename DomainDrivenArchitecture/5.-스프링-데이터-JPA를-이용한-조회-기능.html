<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5. 스프링 데이터 JPA를 이용한 조회 기능 | Today Dockerel Learned</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/TIL/logo.png">
    <meta name="description" content="Dockerel&#39;s Personal Wiki (Today I Learned)">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.40dd5a95.css" as="style"><link rel="preload" href="/TIL/assets/js/app.95f06b87.js" as="script"><link rel="preload" href="/TIL/assets/js/2.188c950f.js" as="script"><link rel="preload" href="/TIL/assets/js/1.a1e51968.js" as="script"><link rel="preload" href="/TIL/assets/js/51.c7dc238d.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.e6f03b60.js"><link rel="prefetch" href="/TIL/assets/js/11.0fba4bf3.js"><link rel="prefetch" href="/TIL/assets/js/12.181bd7bc.js"><link rel="prefetch" href="/TIL/assets/js/13.c5707e1c.js"><link rel="prefetch" href="/TIL/assets/js/14.b086a433.js"><link rel="prefetch" href="/TIL/assets/js/15.3e75d743.js"><link rel="prefetch" href="/TIL/assets/js/16.a2bc07a8.js"><link rel="prefetch" href="/TIL/assets/js/17.b2aac165.js"><link rel="prefetch" href="/TIL/assets/js/18.c240daa0.js"><link rel="prefetch" href="/TIL/assets/js/19.60958448.js"><link rel="prefetch" href="/TIL/assets/js/20.4352d5d9.js"><link rel="prefetch" href="/TIL/assets/js/21.eb4a306c.js"><link rel="prefetch" href="/TIL/assets/js/22.664a6cc8.js"><link rel="prefetch" href="/TIL/assets/js/23.5ae71a00.js"><link rel="prefetch" href="/TIL/assets/js/24.689c8524.js"><link rel="prefetch" href="/TIL/assets/js/25.1aeaac43.js"><link rel="prefetch" href="/TIL/assets/js/26.eb265b20.js"><link rel="prefetch" href="/TIL/assets/js/27.b77d174b.js"><link rel="prefetch" href="/TIL/assets/js/28.3c1e91bd.js"><link rel="prefetch" href="/TIL/assets/js/29.630c9aec.js"><link rel="prefetch" href="/TIL/assets/js/3.e9de9cb1.js"><link rel="prefetch" href="/TIL/assets/js/30.e43ecaae.js"><link rel="prefetch" href="/TIL/assets/js/31.031dd879.js"><link rel="prefetch" href="/TIL/assets/js/32.5fd280ec.js"><link rel="prefetch" href="/TIL/assets/js/33.27f9c496.js"><link rel="prefetch" href="/TIL/assets/js/34.b322d741.js"><link rel="prefetch" href="/TIL/assets/js/35.8ed0e5c2.js"><link rel="prefetch" href="/TIL/assets/js/36.754edecd.js"><link rel="prefetch" href="/TIL/assets/js/37.90b10f8f.js"><link rel="prefetch" href="/TIL/assets/js/38.9411f06d.js"><link rel="prefetch" href="/TIL/assets/js/39.95d679c7.js"><link rel="prefetch" href="/TIL/assets/js/4.c5b6f970.js"><link rel="prefetch" href="/TIL/assets/js/40.e6043a49.js"><link rel="prefetch" href="/TIL/assets/js/41.7d0a7554.js"><link rel="prefetch" href="/TIL/assets/js/42.9afe14b6.js"><link rel="prefetch" href="/TIL/assets/js/43.724770cd.js"><link rel="prefetch" href="/TIL/assets/js/44.2adb638a.js"><link rel="prefetch" href="/TIL/assets/js/45.bcfb7b68.js"><link rel="prefetch" href="/TIL/assets/js/46.a4526624.js"><link rel="prefetch" href="/TIL/assets/js/47.75af35cb.js"><link rel="prefetch" href="/TIL/assets/js/48.de028b34.js"><link rel="prefetch" href="/TIL/assets/js/49.5ce823a3.js"><link rel="prefetch" href="/TIL/assets/js/5.5e20f558.js"><link rel="prefetch" href="/TIL/assets/js/50.04bd63af.js"><link rel="prefetch" href="/TIL/assets/js/52.340f0bc5.js"><link rel="prefetch" href="/TIL/assets/js/53.876bb230.js"><link rel="prefetch" href="/TIL/assets/js/54.63442310.js"><link rel="prefetch" href="/TIL/assets/js/55.e25e9470.js"><link rel="prefetch" href="/TIL/assets/js/56.31674b5b.js"><link rel="prefetch" href="/TIL/assets/js/57.44dc5c05.js"><link rel="prefetch" href="/TIL/assets/js/58.666990ef.js"><link rel="prefetch" href="/TIL/assets/js/59.96b8576d.js"><link rel="prefetch" href="/TIL/assets/js/6.e8a6e3a8.js"><link rel="prefetch" href="/TIL/assets/js/60.cd2bec61.js"><link rel="prefetch" href="/TIL/assets/js/61.4bb53a2e.js"><link rel="prefetch" href="/TIL/assets/js/62.211fe68d.js"><link rel="prefetch" href="/TIL/assets/js/63.8f365667.js"><link rel="prefetch" href="/TIL/assets/js/64.997b7c69.js"><link rel="prefetch" href="/TIL/assets/js/65.e14f40fe.js"><link rel="prefetch" href="/TIL/assets/js/66.c801443d.js"><link rel="prefetch" href="/TIL/assets/js/67.1eac930d.js"><link rel="prefetch" href="/TIL/assets/js/68.c09db326.js"><link rel="prefetch" href="/TIL/assets/js/69.46fdf1b0.js"><link rel="prefetch" href="/TIL/assets/js/7.7fea5211.js"><link rel="prefetch" href="/TIL/assets/js/70.927cffa9.js"><link rel="prefetch" href="/TIL/assets/js/71.e1592c6c.js"><link rel="prefetch" href="/TIL/assets/js/72.46705859.js"><link rel="prefetch" href="/TIL/assets/js/73.bdb3b916.js"><link rel="prefetch" href="/TIL/assets/js/vendors~docsearch.68e379d9.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.40dd5a95.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">Today Dockerel Learned</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Dockerel/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dockerel.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Dockerel/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dockerel.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Backend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>DomainDrivenArchitecture</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/DomainDrivenArchitecture/1.-도메인-모델-시작하기.html" class="sidebar-link">1. 도메인 모델 시작하기</a></li><li><a href="/TIL/DomainDrivenArchitecture/2.-아키텍처-개요.html" class="sidebar-link">2. 아키텍처 개요</a></li><li><a href="/TIL/DomainDrivenArchitecture/3.-애그리거트.html" class="sidebar-link">3. 애그리거트</a></li><li><a href="/TIL/DomainDrivenArchitecture/4.-리포지터리와-모델-구현.html" class="sidebar-link">4. 리포지터리와 모델 구현</a></li><li><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html" class="active sidebar-link">5. 스프링 데이터 JPA를 이용한 조회 기능</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-1-시작에-앞서" class="sidebar-link">5.1 시작에 앞서</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-2-검색을-위한-스펙" class="sidebar-link">5.2 검색을 위한 스펙</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-3-스프링-데이터-jpa를-이용한-스펙-구현" class="sidebar-link">5.3 스프링 데이터 JPA를 이용한 스펙 구현</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-4-리포지터리-dao에서-스펙-사용하기" class="sidebar-link">5.4 리포지터리 / DAO에서 스펙 사용하기</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-5-스펙-조합" class="sidebar-link">5.5 스펙 조합</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-6-정렬-지정하기" class="sidebar-link">5.6 정렬 지정하기</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-7-페이징-처리하기" class="sidebar-link">5.7 페이징 처리하기</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-8-스펙-조합을-위한-스펙-빌더-클래스" class="sidebar-link">5.8 스펙 조합을 위한 스펙 빌더 클래스</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-9-동적-인스턴스-생성" class="sidebar-link">5.9 동적 인스턴스 생성</a></li><li class="sidebar-sub-header"><a href="/TIL/DomainDrivenArchitecture/5.-스프링-데이터-JPA를-이용한-조회-기능.html#_5-10-하이버네이트-subselect-사용" class="sidebar-link">5.10 하이버네이트 @Subselect 사용</a></li></ul></li><li><a href="/TIL/DomainDrivenArchitecture/6.-응용-서비스와-표현-영역.html" class="sidebar-link">6. 응용 서비스와 표현 영역</a></li><li><a href="/TIL/DomainDrivenArchitecture/7.-도메인-서비스.html" class="sidebar-link">7. 도메인 서비스</a></li><li><a href="/TIL/DomainDrivenArchitecture/8.-애그리거트-트랜잭션-관리.html" class="sidebar-link">8. 애그리거트 트랜잭션 관리</a></li><li><a href="/TIL/DomainDrivenArchitecture/9.-도메인-모델과-경계.html" class="sidebar-link">9. 도메인 모델과 경계</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OperatingSystem</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_5-스프링-데이터-jpa를-이용한-조회-기능"><a href="#_5-스프링-데이터-jpa를-이용한-조회-기능" class="header-anchor">#</a> 5. 스프링 데이터 JPA를 이용한 조회 기능</h1> <h2 id="_5-1-시작에-앞서"><a href="#_5-1-시작에-앞서" class="header-anchor">#</a> 5.1 시작에 앞서</h2> <h3 id="cqrs"><a href="#cqrs" class="header-anchor">#</a> CQRS</h3> <ul><li>명령(command) 모델과 조회(Query) 모델을 분리하는 패턴
<ul><li>명령 : 상태를 변경하는 기능 구현</li> <li>조회 : 데이터를 조회하는 기능 구현</li></ul></li></ul> <h2 id="_5-2-검색을-위한-스펙"><a href="#_5-2-검색을-위한-스펙" class="header-anchor">#</a> 5.2 검색을 위한 스펙</h2> <h3 id="스펙"><a href="#스펙" class="header-anchor">#</a> 스펙</h3> <ul><li>검색 조건을 다양하게 조합해야 할 때 사용</li> <li>애그리거트가 특정 조건을 충족하는지를 검사할 때 사용하는 인터페이스</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSatisfiedBy</span><span class="token punctuation">(</span><span class="token class-name">T</span> agg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>검사 대상 객체가 조건을 충족하면 true, 아니면 false</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> spec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> allOrders <span class="token operator">=</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> allOrders<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>order <span class="token operator">-&gt;</span> spec<span class="token punctuation">.</span><span class="token function">isSatisfiedBy</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>위 코드와 같이 검색 대상을 걸러내는 용도로 사용</li> <li>근데 실제 스펙은 이렇게 구현하지 않음 → 메모리, 조회 성능 문제</li></ul> <h2 id="_5-3-스프링-데이터-jpa를-이용한-스펙-구현"><a href="#_5-3-스프링-데이터-jpa를-이용한-스펙-구현" class="header-anchor">#</a> 5.3 스프링 데이터 JPA를 이용한 스펙 구현</h2> <p>스프링 데이터 JPA는 검색 조건을 표현하기 위한 Specification 인터페이스가 존재함</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PointLog</span><span class="token punctuation">&gt;</span></span> <span class="token function">hasUserId</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> query<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> cb<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;member&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>대신</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@StaticMetamodel</span><span class="token punctuation">(</span><span class="token class-name">PointLog</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PointLog_</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">SingularAttribute</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PointLog</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PointLog</span><span class="token punctuation">&gt;</span></span> <span class="token function">hasUserId</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> query<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> cb<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;member&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>이렇게 정적 메타 모델을 사용하면 컴파일 시 오류 발견 가능</p> <p>별도 클래스에 스펙 생성 기능을 모아도 굿</p> <h2 id="_5-4-리포지터리-dao에서-스펙-사용하기"><a href="#_5-4-리포지터리-dao에서-스펙-사용하기" class="header-anchor">#</a> 5.4 리포지터리 / DAO에서 스펙 사용하기</h2> <ul><li>findAll(spec) 으로 스펙을 적용해서 검색 가능</li></ul> <h2 id="_5-5-스펙-조합"><a href="#_5-5-스펙-조합" class="header-anchor">#</a> 5.5 스펙 조합</h2> <ul><li><code>and</code>, <code>or</code> 로 스펙 조합 가능</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PointLog</span><span class="token punctuation">&gt;</span></span> combinedSpec <span class="token operator">=</span> spec1<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>spec2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>Specification.not()</code> 으로 반대로 적용도 가능</li></ul> <h2 id="_5-6-정렬-지정하기"><a href="#_5-6-정렬-지정하기" class="header-anchor">#</a> 5.6 정렬 지정하기</h2> <h3 id="스프링-데이터-jpa에서-정렬-지정하는-법"><a href="#스프링-데이터-jpa에서-정렬-지정하는-법" class="header-anchor">#</a> 스프링 데이터 JPA에서 정렬 지정하는 법</h3> <ul><li>메서드 이름에 OrderBy 사용해서 정렬 기준 지정</li> <li>Sort를 인자로 전달</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderSummay</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByOrdererIdOrderByNumberDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> ordererId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>findByOrdererIdOrderByOrderDateDescNumberAsc → 이런건 너무 김</li></ul> <h3 id="sort-타입-사용"><a href="#sort-타입-사용" class="header-anchor">#</a> Sort 타입 사용</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ascending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderSummary</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> orderSummaryDao<span class="token punctuation">.</span><span class="token function">findByOrderId</span><span class="token punctuation">(</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">,</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>and</code>로 연결 가능</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Sort</span> combinedSort <span class="token operator">=</span> sort1<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>sort2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_5-7-페이징-처리하기"><a href="#_5-7-페이징-처리하기" class="header-anchor">#</a> 5.7 페이징 처리하기</h2> <ul><li>PageRequest 클래스로 호출 가능</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">PageRequest</span> pageReq <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberData</span><span class="token punctuation">&gt;</span></span> user <span class="token operator">=</span> memberDataDao<span class="token punctuation">.</span><span class="token function">findByNameLike</span><span class="token punctuation">(</span><span class="token string">&quot;사용자%&quot;</span><span class="token punctuation">,</span> pageReq<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>sort도 지정 가능</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">descending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PageRequest</span> pageReq <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberData</span><span class="token punctuation">&gt;</span></span> user <span class="token operator">=</span> memberDataDao<span class="token punctuation">.</span><span class="token function">findByNameLike</span><span class="token punctuation">(</span><span class="token string">&quot;사용자%&quot;</span><span class="token punctuation">,</span> pageReq<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>페이징 쿼리는 전체 개수, 페이지 개수 등 페이지 처리에 필요한 데이터도 함꼐 제공</li> <li>만약에 이런게 필요없으면 리턴 타입으로 Page 대신 List 사용하기</li> <li>Page 관련 성능개선 : https://jojoldu.tistory.com/530</li></ul> <h2 id="_5-8-스펙-조합을-위한-스펙-빌더-클래스"><a href="#_5-8-스펙-조합을-위한-스펙-빌더-클래스" class="header-anchor">#</a> 5.8 스펙 조합을 위한 스펙 빌더 클래스</h2> <h3 id="ex"><a href="#ex" class="header-anchor">#</a> EX</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Check</span><span class="token punctuation">&gt;</span></span> spec <span class="token operator">=</span> <span class="token class-name">SpecBuilder</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token class-name">Check</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token class-name">CheckSpecs</span><span class="token punctuation">.</span><span class="token function">yearQuarter</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> searchRequest<span class="token punctuation">.</span><span class="token function">getQuarter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ifHasText</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">.</span><span class="token function">getTeamCd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str <span class="token operator">-&gt;</span> <span class="token class-name">CheckSpec</span><span class="token punctuation">.</span><span class="token function">teamCd</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ifHasText</span><span class="token punctuation">(</span>searchRequest<span class="token punctuation">.</span><span class="token function">getPlanDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CheckSpec</span><span class="token operator">::</span><span class="token function">planDate</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toSpec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Check</span><span class="token punctuation">&gt;</span></span> checks <span class="token operator">=</span> checkRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>specs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="specbuilder-class"><a href="#specbuilder-class" class="header-anchor">#</a> SpecBuilder.class</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpecBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">builder</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Specification</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> specs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addSpec</span><span class="token punctuation">(</span><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> spec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>spec <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                specs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">and</span><span class="token punctuation">(</span><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> spec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">addSpec</span><span class="token punctuation">(</span>spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">ifHasText</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span>
                                    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Specification</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> specSupplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">addSpec</span><span class="token punctuation">(</span>specSupplier<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">ifTrue</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span> cond<span class="token punctuation">,</span>
                                 <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Specification</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> specSupplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cond <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cond<span class="token punctuation">.</span><span class="token function">booleanValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">addSpec</span><span class="token punctuation">(</span>specSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">ifNotNull</span><span class="token punctuation">(</span><span class="token class-name">V</span> value<span class="token punctuation">,</span>
                                        <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">,</span> <span class="token class-name">Specification</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> specSupplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">addSpec</span><span class="token punctuation">(</span>specSupplier<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">toSpec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> spec <span class="token operator">=</span> <span class="token class-name">Specification</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> s <span class="token operator">:</span> specs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                spec <span class="token operator">=</span> spec<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> spec<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-9-동적-인스턴스-생성"><a href="#_5-9-동적-인스턴스-생성" class="header-anchor">#</a> 5.9 동적 인스턴스 생성</h2> <ul><li>JPA는 쿼리 결과에서 임의의 객체를 동적으로 생성할 수 있는 기능이 있음</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">&quot;&quot;&quot;
			select new com.myshop.order.query.dto.OrderView(
				o.number, o.state, m.name, m.id, p.name
			)
			from ~
			...
&quot;&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderView</span><span class="token punctuation">&gt;</span></span> <span class="token function">findOrderView</span><span class="token punctuation">(</span><span class="token class-name">String</span> ordererId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>JPQL을 그대로 사용하므로 객체 기준으로 쿼리를 작성하면서도, 동시에 지연/즉시로딩과 같은 고민 없이 원하는 모습으로 데이터를 조회할 수 있음</li> <li>영속성 컨텍스트에 의해 관리되지 않지만 조회 전용이므로 괜찮음</li></ul> <h2 id="_5-10-하이버네이트-subselect-사용"><a href="#_5-10-하이버네이트-subselect-사용" class="header-anchor">#</a> 5.10 하이버네이트 @Subselect 사용</h2> <ul><li>하이버네이트는 JPA 확장 기능으로 @Subselect 제공</li> <li>쿼리 결과를 @Entity로 매핑할 수 있는 유용한 기능</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Immutable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Subselect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Synchronize</span></span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
 
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Immutable</span>
<span class="token annotation punctuation">@Subselect</span><span class="token punctuation">(</span><span class="token string">&quot;select o.order_number as number, &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;o.version, &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;o.orderer_id, &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;o.orderer_name, &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;o.total_amounts, &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;o.receiver_name, &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;o.state, &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;o.order_date, &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;p.product_id, &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;p.name as product_name &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;from purchase_order o inner join order_line ol &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;    on o.order_number = ol.order_number &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;    cross join product p &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;where &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;ol.line_idx = 0 &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;and ol.product_id = p.product_id&quot;</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Synchronize</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;purchase_order&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;order_line&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;product&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderSummary</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> number<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> version<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> ordererId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> ordererName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> totalAmounts<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> receiverName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> state<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Temporal</span><span class="token punctuation">(</span><span class="token class-name">TemporalType</span><span class="token punctuation">.</span><span class="token constant">TIMESTAMP</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;orderDate&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> orderDate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productName<span class="token punctuation">;</span>
 
    <span class="token keyword">protected</span> <span class="token class-name">OrderSummary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>쿼리 실행 결과를 매핑할 테이블처럼 사용</li> <li>수정 불가능</li> <li>@SubSelect를 이용한 @Entity 수정 시 update 쿼리 발생 → 매핑 한 테이블 없음 → 에러 발생</li> <li>그래서 @Immutable 사용해서 DB에 반영 무시</li> <li>@Synchronize 쓰면 명시된 테이블 목록을 참고해서 변경 반영</li> <li>@SubSelect를 사용하면 일반 @Entity 처럼 spec, page 등도 가능</li> <li>@SubSelect 의 값으로 지정한 부분이 from 절로 들어감 → 서브쿼리 사용하고 싶지 않으면 네이티브 sql 사용 or 마이바티스와 같은 mapper 사용해서 조회 기능 구현해야 함</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/DomainDrivenArchitecture/4.-리포지터리와-모델-구현.html" class="prev">
        4. 리포지터리와 모델 구현
      </a></span> <span class="next"><a href="/TIL/DomainDrivenArchitecture/6.-응용-서비스와-표현-영역.html">
        6. 응용 서비스와 표현 영역
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.95f06b87.js" defer></script><script src="/TIL/assets/js/2.188c950f.js" defer></script><script src="/TIL/assets/js/1.a1e51968.js" defer></script><script src="/TIL/assets/js/51.c7dc238d.js" defer></script>
  </body>
</html>
