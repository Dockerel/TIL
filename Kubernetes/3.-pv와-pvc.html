<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3. PV와 PVC | Today Dockerel Learned</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/TIL/logo.png">
    <meta name="description" content="Dockerel&#39;s Personal Wiki (Today I Learned)">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.40dd5a95.css" as="style"><link rel="preload" href="/TIL/assets/js/app.c6b9857f.js" as="script"><link rel="preload" href="/TIL/assets/js/2.188c950f.js" as="script"><link rel="preload" href="/TIL/assets/js/1.a1e51968.js" as="script"><link rel="preload" href="/TIL/assets/js/61.3b46f4ca.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.e6f03b60.js"><link rel="prefetch" href="/TIL/assets/js/11.0fba4bf3.js"><link rel="prefetch" href="/TIL/assets/js/12.181bd7bc.js"><link rel="prefetch" href="/TIL/assets/js/13.c5707e1c.js"><link rel="prefetch" href="/TIL/assets/js/14.b086a433.js"><link rel="prefetch" href="/TIL/assets/js/15.3e75d743.js"><link rel="prefetch" href="/TIL/assets/js/16.a2bc07a8.js"><link rel="prefetch" href="/TIL/assets/js/17.33ccdb0f.js"><link rel="prefetch" href="/TIL/assets/js/18.c240daa0.js"><link rel="prefetch" href="/TIL/assets/js/19.60958448.js"><link rel="prefetch" href="/TIL/assets/js/20.4352d5d9.js"><link rel="prefetch" href="/TIL/assets/js/21.391074bf.js"><link rel="prefetch" href="/TIL/assets/js/22.664a6cc8.js"><link rel="prefetch" href="/TIL/assets/js/23.5ae71a00.js"><link rel="prefetch" href="/TIL/assets/js/24.d267629a.js"><link rel="prefetch" href="/TIL/assets/js/25.1aeaac43.js"><link rel="prefetch" href="/TIL/assets/js/26.966808ab.js"><link rel="prefetch" href="/TIL/assets/js/27.96954a7a.js"><link rel="prefetch" href="/TIL/assets/js/28.d3b9c4c7.js"><link rel="prefetch" href="/TIL/assets/js/29.ddbd73e9.js"><link rel="prefetch" href="/TIL/assets/js/3.e9de9cb1.js"><link rel="prefetch" href="/TIL/assets/js/30.55802351.js"><link rel="prefetch" href="/TIL/assets/js/31.2ec5b8f6.js"><link rel="prefetch" href="/TIL/assets/js/32.5fd280ec.js"><link rel="prefetch" href="/TIL/assets/js/33.27f9c496.js"><link rel="prefetch" href="/TIL/assets/js/34.b322d741.js"><link rel="prefetch" href="/TIL/assets/js/35.8ed0e5c2.js"><link rel="prefetch" href="/TIL/assets/js/36.04a7ca97.js"><link rel="prefetch" href="/TIL/assets/js/37.55d41140.js"><link rel="prefetch" href="/TIL/assets/js/38.44c2873a.js"><link rel="prefetch" href="/TIL/assets/js/39.d5e34e87.js"><link rel="prefetch" href="/TIL/assets/js/4.c5b6f970.js"><link rel="prefetch" href="/TIL/assets/js/40.2fa0dc7a.js"><link rel="prefetch" href="/TIL/assets/js/41.5d4d9c9e.js"><link rel="prefetch" href="/TIL/assets/js/42.1602bec9.js"><link rel="prefetch" href="/TIL/assets/js/43.ed44001c.js"><link rel="prefetch" href="/TIL/assets/js/44.a29595e6.js"><link rel="prefetch" href="/TIL/assets/js/45.9d19a39c.js"><link rel="prefetch" href="/TIL/assets/js/46.ce0941a8.js"><link rel="prefetch" href="/TIL/assets/js/47.07bc4f54.js"><link rel="prefetch" href="/TIL/assets/js/48.f38f0bf5.js"><link rel="prefetch" href="/TIL/assets/js/49.8f7b9cd6.js"><link rel="prefetch" href="/TIL/assets/js/5.5e20f558.js"><link rel="prefetch" href="/TIL/assets/js/50.3e44bb02.js"><link rel="prefetch" href="/TIL/assets/js/51.99ae272d.js"><link rel="prefetch" href="/TIL/assets/js/52.cc562289.js"><link rel="prefetch" href="/TIL/assets/js/53.29881cda.js"><link rel="prefetch" href="/TIL/assets/js/54.2c1e7724.js"><link rel="prefetch" href="/TIL/assets/js/55.91bcf5c4.js"><link rel="prefetch" href="/TIL/assets/js/56.03d1f002.js"><link rel="prefetch" href="/TIL/assets/js/57.bd1a5145.js"><link rel="prefetch" href="/TIL/assets/js/58.72096ec4.js"><link rel="prefetch" href="/TIL/assets/js/59.bce40f9f.js"><link rel="prefetch" href="/TIL/assets/js/6.e8a6e3a8.js"><link rel="prefetch" href="/TIL/assets/js/60.5d5194ad.js"><link rel="prefetch" href="/TIL/assets/js/62.9c4ed0d5.js"><link rel="prefetch" href="/TIL/assets/js/63.d79bddec.js"><link rel="prefetch" href="/TIL/assets/js/64.b1b6958d.js"><link rel="prefetch" href="/TIL/assets/js/65.24726a0c.js"><link rel="prefetch" href="/TIL/assets/js/66.a5fc8da8.js"><link rel="prefetch" href="/TIL/assets/js/7.7fea5211.js"><link rel="prefetch" href="/TIL/assets/js/vendors~docsearch.68e379d9.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.40dd5a95.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">Today Dockerel Learned</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Dockerel/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dockerel.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Dockerel/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dockerel.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Backend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DomainDrivenArchitecture</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OperatingSystem</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Kubernetes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/Kubernetes/1.-포드,-레플리카-셋,-디플로이먼트,-서비스.html" class="sidebar-link">1.포드, 레플리카 셋, 디플로이먼트, 서비스</a></li><li><a href="/TIL/Kubernetes/2.-네임스페이스,-컨피그맵,-시크릿,-인그레스.html" class="sidebar-link">2. 네임스페이스, 컨피그맵, 시크릿, 인그레스</a></li><li><a href="/TIL/Kubernetes/3.-pv와-pvc.html" class="active sidebar-link">3. PV와 PVC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/Kubernetes/3.-pv와-pvc.html#pv" class="sidebar-link">PV</a></li><li class="sidebar-sub-header"><a href="/TIL/Kubernetes/3.-pv와-pvc.html#nfs" class="sidebar-link">NFS</a></li><li class="sidebar-sub-header"><a href="/TIL/Kubernetes/3.-pv와-pvc.html#nfs를-네트워크-볼륨으로-사용하기" class="sidebar-link">NFS를 네트워크 볼륨으로 사용하기</a></li><li class="sidebar-sub-header"><a href="/TIL/Kubernetes/3.-pv와-pvc.html#pv와-pvc를-이용한-볼륨-관리" class="sidebar-link">PV와 PVC를 이용한 볼륨 관리</a></li><li class="sidebar-sub-header"><a href="/TIL/Kubernetes/3.-pv와-pvc.html#pv와-pvc-사용하기" class="sidebar-link">PV와 PVC 사용하기</a></li><li class="sidebar-sub-header"><a href="/TIL/Kubernetes/3.-pv와-pvc.html#pv를-선택하기-위한-조건들" class="sidebar-link">PV를 선택하기 위한 조건들</a></li><li class="sidebar-sub-header"><a href="/TIL/Kubernetes/3.-pv와-pvc.html#pv의-라이프사이클과-reclaim-policy" class="sidebar-link">PV의 라이프사이클과 Reclaim Policy</a></li><li class="sidebar-sub-header"><a href="/TIL/Kubernetes/3.-pv와-pvc.html#다이나믹-프로비저닝과-스토리지-클래스" class="sidebar-link">다이나믹 프로비저닝과 스토리지 클래스</a></li></ul></li><li><a href="/TIL/Kubernetes/4.-ServiceAccount와-RBAC.html" class="sidebar-link">4. ServiceAccount와 RBAC</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_3-pv와-pvc"><a href="#_3-pv와-pvc" class="header-anchor">#</a> 3. PV와 PVC</h1> <p>쿠버네티스에서도 도커와 같이 호스트에 위치한 디렉터리를 각 포드와 공유함으로써 데이터를 보존하는 것이 가능
<br>
그렇지만 쿠버네티스와 같이 다중 서버로 구성된 환경에서는 적합하지 않음
<br></p> <p>→ 그럴 때 사용하는 것이 PV(Persistent Volume)</p> <h2 id="pv"><a href="#pv" class="header-anchor">#</a> PV</h2> <p><img src="https://images.velog.io/images/ynsoo1225/post/1f9cb034-6a0b-4773-a4ed-9c1a2f6db778/655C45BC-85C5-4976-91D0-9840D045B2A8.jpeg" alt=""></p> <ul><li>워커 노드들이 네트워크상에서 스토리지를 마운트해 영속적으로 데이터를 저장할 수 있는 볼륨</li> <li>포드에 장애가 생겨 다른 노드로 옮겨가더라도 해동 노드에서 PV에 네트워크로 연결해 데이터를 계속 사용 가능</li></ul> <h2 id="nfs"><a href="#nfs" class="header-anchor">#</a> NFS</h2> <ul><li>여러 서버 혹은 Pod에서 동시에 접근 가능한 파일 시스템을 NFS(Network File System)이라 함</li></ul> <h2 id="nfs를-네트워크-볼륨으로-사용하기"><a href="#nfs를-네트워크-볼륨으로-사용하기" class="header-anchor">#</a> NFS를 네트워크 볼륨으로 사용하기</h2> <h3 id="호스트-raspberry-pi-에-직접-nfs-서버-설치-후-연결"><a href="#호스트-raspberry-pi-에-직접-nfs-서버-설치-후-연결" class="header-anchor">#</a> 호스트(Raspberry Pi)에 직접 NFS 서버 설치 후 연결</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>mount<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;tail&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/dev/null&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>volume
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /mnt
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>volume
      <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/export/nfs&quot;</span>
        <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.0.7
</code></pre></div><ul><li>AWS나 GCP에서 제공하는 NFS 사용해도 됨</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>dgh0001@rpi4b:~/study$ kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> nfs-pod -- <span class="token function">sh</span>
/ <span class="token comment"># df -h</span>
Filesystem                 Size      Used Available Use% Mounted on
<span class="token number">192.168</span>.0.7:/export/nfs  <span class="token number">219</span>.6G     <span class="token number">28</span>.2G    <span class="token number">182</span>.5G  <span class="token number">13</span>% /mnt
</code></pre></div><h2 id="pv와-pvc를-이용한-볼륨-관리"><a href="#pv와-pvc를-이용한-볼륨-관리" class="header-anchor">#</a> PV와 PVC를 이용한 볼륨 관리</h2> <ul><li>위 방식으로 NFS를 바로 명시해서 사용하면 서로 밀접하게 연관되어 있어 서로 분리할 수 없어짐</li> <li>이를 해결하기 위해 PV와 PVC 사용
<img src="https://user-images.githubusercontent.com/47745785/149604997-5971fc24-edbd-48bd-9d6f-024a6c76693e.png" alt=""></li></ul> <ol><li>인프라 관리자가 네트워크 볼륨 서버로 PV 리소스를 미리 생성</li> <li>사용자(개발자)가 포드를 정의하는 YAML 파일 등에 &quot;영속적인 데이터 저장을 위한 외부 볼륨이 필요함&quot;을 명시 후 해당 PVC 생성</li> <li>쿠버네티스가 기존에 생성해뒀던 PV의 속성과 사용자가 요청한 PVC의 요구 사항이 일치하면 두 리소스를 매칭시켜 바인딩함</li></ol> <ul><li>즉, 사용자는 디플로이먼트의 YAML 파일에서 볼륨의 상세한 스펙을 정의하지 않아도 됨</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># Before</span>
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>volume
<span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /
    <span class="token key atrule">server</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>NFS_SERVER_IP<span class="token punctuation">}</span>

<span class="token comment"># After</span>
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>volume
  <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
    <span class="token key atrule">claimName</span><span class="token punctuation">:</span> mtpvc
</code></pre></div><h2 id="pv와-pvc-사용하기"><a href="#pv와-pvc-사용하기" class="header-anchor">#</a> PV와 PVC 사용하기</h2> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pv
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 10Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/export/nfs&quot;</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.0.7
  <span class="token key atrule">mountOptions</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> nfsvers=4
</code></pre></div><h3 id="pvc-생성-후-pod-생성-시-pvc적용"><a href="#pvc-생성-후-pod-생성-시-pvc적용" class="header-anchor">#</a> PVC 생성 후 Pod 생성 시 PVC적용</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pvc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token comment"># 조건 1</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi <span class="token comment"># 조건 2</span>

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>mount<span class="token punctuation">-</span>container
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;tail&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/dev/null&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>volume
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /mnt
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>volume
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pvc
</code></pre></div><h3 id="실행-결과"><a href="#실행-결과" class="header-anchor">#</a> 실행 결과</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>dgh0001@rpi4b:~/study$ kubectl get pv,pvc
NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS
persistentvolume/nfs-pv                                     10Gi       RWX            Retain           Bound

NAME                              STATUS    VOLUME                                     CAPACITY   ACCESS MODES
persistentvolumeclaim/my-pvc      Bound     nfs-pv                                     10Gi       RWX
</code></pre></div><ul><li>PV와 PVC의 상태(STATUS)가 Bound로 설정되어 있으면 정상적으로 마운트 된 상태</li></ul> <p><strong>PV와 PVC의 차이 - 네임스페이스</strong></p> <ul><li>PV는 네임스페이스에 속하지 않는 클러스터 단위의 오브젝트</li> <li>PVC는 네임스페이스에 속하는 클러스터 단위의 오브젝트</li></ul> <h2 id="pv를-선택하기-위한-조건들"><a href="#pv를-선택하기-위한-조건들" class="header-anchor">#</a> PV를 선택하기 위한 조건들</h2> <h3 id="accessmodes"><a href="#accessmodes" class="header-anchor">#</a> accessModes</h3> <table><thead><tr><th>accessModes 이름</th> <th>설명</th></tr></thead> <tbody><tr><td>ReadWriteOnce</td> <td>1:1 마운트만 가능, 읽기 쓰기 가능</td></tr> <tr><td>ReadOnlyMany</td> <td>1:N 마운트 가능, 읽기 전용</td></tr> <tr><td>ReadWriteMany</td> <td>1:N 마운트 가능, 읽기 쓰기 가능</td></tr></tbody></table> <ul><li>사용하는 NFS 종류에 따라 다름(ex. EBS는 1:1 관계의 마운트만 가능)</li> <li>그 외에도 볼륨의 크기, 스토리지 클래스, 라벨 셀렉터 등이 있음</li></ul> <h2 id="pv의-라이프사이클과-reclaim-policy"><a href="#pv의-라이프사이클과-reclaim-policy" class="header-anchor">#</a> PV의 라이프사이클과 Reclaim Policy</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>dgh0001@rpi4b:~/study$ kubectl delete <span class="token parameter variable">-f</span> nfs-pod.yaml
persistentvolumeclaim <span class="token string">&quot;my-pvc&quot;</span> deleted from default namespace

dgh0001@rpi4b:~/study$ kubectl get <span class="token function">pv</span>
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS
nfs-pv                                     10Gi       RWX            Retain           Released
</code></pre></div><ul><li>Available → Bound → Released</li> <li>Released는 해당 PV의 사용이 끝났지만, 실제 데이터들이 안에 Retain이라는 Reclaim Policy로 보존되어 있기 때문에 다시 사용 불가능함</li></ul> <h3 id="retain-policy"><a href="#retain-policy" class="header-anchor">#</a> Retain Policy</h3> <ul><li>PVC 삭제 시 PV의 데이터를 어떻게 처리할 것인지 별도로 정의 가능</li> <li>보통은 데이터를 영구적으로 저장하기 위해 <code>Retain</code> 옵션 사용</li> <li><code>Delete</code> 사용 시 자동으로 PV까지 삭제</li> <li><code>Recycle</code> 사용 시 PV의 데이터를 모두 삭제한 후 다시 Available 상태로 만들어줌 (Deprecated 예정)</li></ul> <h2 id="다이나믹-프로비저닝과-스토리지-클래스"><a href="#다이나믹-프로비저닝과-스토리지-클래스" class="header-anchor">#</a> 다이나믹 프로비저닝과 스토리지 클래스</h2> <ul><li>PV를 사용하려면 미리 외부 스토리지를 준비해야 햇음</li> <li>쿠버네티스는 다이나믹 프로비저닝을 통해 PVC와 일치하는 PV가 존재하지 않으면 자동으로 PV와 외부 스토리지를 함께 프로비저닝 함
<img src="https://user-images.githubusercontent.com/47745785/151692828-7e551d9c-1e62-4785-a67e-1535aa70ebc6.png" alt=""></li> <li>위 그림과 같이 만족하는 PV가 없으면 스토리지 클래스에 정의된 속성에 따라 외부 스토리지 생성</li> <li>다이나믹 프로비저닝 기능을 사용하기 위해서는 미리 해당 기능이 지원되는 스토리지 프로비저너가 활성화되어 있어야 함</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> nfs.csi.k8s.io
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.0.7
  <span class="token key atrule">share</span><span class="token punctuation">:</span> <span class="token string">&quot;/export/nfs&quot;</span>
<span class="token key atrule">reclaimPolicy</span><span class="token punctuation">:</span> Delete

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pvc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> test
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi
</code></pre></div><h3 id="결과"><a href="#결과" class="header-anchor">#</a> 결과</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>dgh0001@rpi4b:~/study$ kubectl apply <span class="token parameter variable">-f</span> pvc-test.yaml
persistentvolumeclaim/test-pvc created

dgh0001@rpi4b:~/study$ kubectl get pv,pvc
NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM              STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
persistentvolume/pvc-c228acb2-7053-44d4-a499-8b469d5d96c1   5Gi        RWX            Delete           Bound    default/test-pvc   <span class="token builtin class-name">test</span>           <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>                          11s

NAME                             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/test-pvc   Bound    pvc-c228acb2-7053-44d4-a499-8b469d5d96c1   5Gi        RWX            <span class="token builtin class-name">test</span>           <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>                 14s
</code></pre></div><h3 id="특정-스토리지-클래스-기본값으로-사용"><a href="#특정-스토리지-클래스-기본값으로-사용" class="header-anchor">#</a> 특정 스토리지 클래스 기본값으로 사용</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">storageclass.kubernetes.io/is-default-class</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> nfs.csi.k8s.io
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.0.7
  <span class="token key atrule">share</span><span class="token punctuation">:</span> <span class="token string">&quot;/export/nfs&quot;</span>
<span class="token key atrule">reclaimPolicy</span><span class="token punctuation">:</span> Delete
</code></pre></div><ul><li>어노테이션 추가로 사용할 디폴트 스토리지 클래스 설정 가능</li></ul> <h3 id="결과-2"><a href="#결과-2" class="header-anchor">#</a> 결과</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>dgh0001@rpi4b:~/study$ kubectl get sc
NAME             PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
<span class="token builtin class-name">test</span> <span class="token punctuation">(</span>default<span class="token punctuation">)</span>   nfs.csi.k8s.io   Delete          Immediate           <span class="token boolean">false</span>                  73s
</code></pre></div><ul><li>별도로 스토리지 클래스 명시 안하면 자동으로 기본 설정된 스토리지 클래스를 통해 다이나믹 프로비저닝 수행</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/Kubernetes/2.-네임스페이스,-컨피그맵,-시크릿,-인그레스.html" class="prev">
        2. 네임스페이스, 컨피그맵, 시크릿, 인그레스
      </a></span> <span class="next"><a href="/TIL/Kubernetes/4.-ServiceAccount와-RBAC.html">
        4. ServiceAccount와 RBAC
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.c6b9857f.js" defer></script><script src="/TIL/assets/js/2.188c950f.js" defer></script><script src="/TIL/assets/js/1.a1e51968.js" defer></script><script src="/TIL/assets/js/61.3b46f4ca.js" defer></script>
  </body>
</html>
